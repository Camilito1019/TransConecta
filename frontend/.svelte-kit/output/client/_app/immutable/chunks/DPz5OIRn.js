import{y as d,$ as m,a4 as o,a0 as v,A as l,T as p,E as u,M as _,aF as b,U as g,B as k,ac as w,G as y,aG as F,aH as A,t as M,F as E}from"./DdWuALZu.js";class T{anchor;#t=new Map;#s=new Map;#e=new Map;#a=new Set;#i=!0;constructor(s,a=!0){this.anchor=s,this.#i=a}#r=()=>{var s=d;if(this.#t.has(s)){var a=this.#t.get(s),t=this.#s.get(a);if(t)m(t),this.#a.delete(a);else{var e=this.#e.get(a);e&&(this.#s.set(a,e.effect),this.#e.delete(a),e.fragment.lastChild.remove(),this.anchor.before(e.fragment),t=e.effect)}for(const[i,r]of this.#t){if(this.#t.delete(i),i===s)break;const n=this.#e.get(r);n&&(o(n.effect),this.#e.delete(r))}for(const[i,r]of this.#s){if(i===a||this.#a.has(i))continue;const n=()=>{if(Array.from(this.#t.values()).includes(i)){var h=document.createDocumentFragment();b(r,h),h.append(l()),this.#e.set(i,{effect:r,fragment:h})}else o(r);this.#a.delete(i),this.#s.delete(i)};this.#i||!t?(this.#a.add(i),v(r,n,!1)):n()}}};#n=s=>{this.#t.delete(s);const a=Array.from(this.#t.values());for(const[t,e]of this.#e)a.includes(t)||(o(e.effect),this.#e.delete(t))};ensure(s,a){var t=d,e=g();if(a&&!this.#s.has(s)&&!this.#e.has(s))if(e){var i=document.createDocumentFragment(),r=l();i.append(r),this.#e.set(s,{effect:p(()=>a(r)),fragment:i})}else this.#s.set(s,p(()=>a(this.anchor)));if(this.#t.set(t,s),e){for(const[n,c]of this.#s)n===s?t.skipped_effects.delete(c):t.skipped_effects.add(c);for(const[n,c]of this.#e)n===s?t.skipped_effects.delete(c.effect):t.skipped_effects.add(c.effect);t.oncommit(this.#r),t.ondiscard(this.#n)}else u&&(this.anchor=_),this.#r()}}function B(f,s,...a){var t=new T(f);k(()=>{const e=s()??null;t.ensure(e,e&&(i=>e(i,...a)))},w)}function R(f){return(s,...a)=>{var t=f(...a),e;if(u)e=_,y();else{var i=t.render().trim(),r=F(i);e=E(r),s.before(e)}const n=t.setup?.(e);A(e,e),typeof n=="function"&&M(n)}}export{T as B,R as c,B as s};
