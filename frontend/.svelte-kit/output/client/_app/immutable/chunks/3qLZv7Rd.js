import{w as a}from"./D5sqcERo.js";const m="http://localhost:3000/api";class p{constructor(){this.token=this.getToken()}getToken(){return typeof window<"u"?localStorage.getItem("auth_token"):null}setToken(r){this.token=r,typeof window<"u"&&localStorage.setItem("auth_token",r)}clearToken(){this.token=null,typeof window<"u"&&localStorage.removeItem("auth_token")}async request(r,n={}){const s=n.body instanceof FormData,i={...s?{}:{"Content-Type":"application/json"},...n.headers},c=this.getToken();c&&(i.Authorization=`Bearer ${c}`);const u=`${m}${r}`,g={...n,body:!s&&n.body&&typeof n.body=="object"&&!(n.body instanceof String)?JSON.stringify(n.body):n.body,headers:i};try{const o=await fetch(u,g);if(!o.ok){const h=await o.json();throw o.status===401&&(console.warn("游뛂 Error 401: Token inv치lido o expirado"),this.clearToken(),typeof document<"u"&&(document.cookie="auth_token=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;")),new Error(h.error||`HTTP ${o.status}`)}return await o.json()}catch(o){throw console.error(`Error en ${r}:`,o),o}}get(r){return this.request(r,{method:"GET"})}post(r,n){return this.request(r,{method:"POST",body:JSON.stringify(n)})}put(r,n){return this.request(r,{method:"PUT",body:JSON.stringify(n)})}patch(r,n){return this.request(r,{method:"PATCH",body:JSON.stringify(n)})}delete(r){return this.request(r,{method:"DELETE"})}}const t=new p,l={async login(e,r){return t.post("/login",{correo:e,contrase침a:r})},async logout(){return t.clearToken(),typeof document<"u"&&(document.cookie="auth_token=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;"),{mensaje:"Sesi칩n cerrada"}},async me(){return t.get("/me")},async actualizarPerfil(e){return t.put("/me",e)},setToken(e){t.setToken(e)},getToken(){return t.getToken()},isAuthenticated(){return!!t.getToken()}},$={async registrar(e,r,n){return t.post("/usuarios",{nombre_usuario:e,correo:r,id_rol:n,estado:"activo"})},async listar(){return t.get("/usuarios")},async obtener(e){return t.get(`/usuarios/${e}`)},async actualizar(e,r){return t.put(`/usuarios/${e}`,r)},async inactivar(e){return t.patch(`/usuarios/${e}/inactivar`,{})},async activar(e){return t.patch(`/usuarios/${e}/activar`,{})},async eliminar(e){return t.delete(`/usuarios/${e}`)},async asignarRol(e,r){return t.put(`/usuarios/${e}/rol`,{id_rol:r})},async cambiarContrase침a(e,r,n){const s={contrasena_actual:e,contrasena_nueva:r};return n&&(s.id_usuario=n),t.post("/cambiar-contrasena",s)}},v={async listar(){return t.get("/roles")},async crear(e,r){return t.post("/roles",{nombre_rol:e,descripcion:r})},async obtener(e){return t.get(`/roles/${e}`)},async actualizar(e,r,n){return t.put(`/roles/${e}`,{nombre_rol:r,descripcion:n})},async eliminar(e){return t.delete(`/roles/${e}`)}},b={async crear(e){return t.post("/vehiculos",e)},async listar(){return t.get("/vehiculos")},async obtener(e){return t.get(`/vehiculos/${e}`)},async actualizar(e,r){return t.put(`/vehiculos/${e}`,r)},async desactivar(e){return t.patch(`/vehiculos/${e}/desactivar`,{})},async activar(e){return t.patch(`/vehiculos/${e}/activar`,{})},async eliminar(e){return t.delete(`/vehiculos/${e}`)},async cambiarEstado(e,r){return t.patch(`/vehiculos/${e}/estado`,{estado_operativo:r})},async obtenerHistorial(e){return t.get(`/vehiculos/${e}/historial`)}},T={async subirDocumento(e,r){return t.request(`/vehiculos/${e}/documentos`,{method:"POST",body:r,headers:{}})},async listarDocumentos(e){return t.get(`/vehiculos/${e}/documentos`)},async obtenerDocumento(e){return t.get(`/documentos/${e}`)},async descargarDocumento(e){return t.get(`/documentos/${e}/descargar`)}},k={async crear(e){return t.post("/conductores",e)},async listar(){return t.get("/conductores")},async obtener(e){return t.get(`/conductores/${e}`)},async actualizar(e,r){return t.put(`/conductores/${e}`,r)},async desactivar(e){return t.patch(`/conductores/${e}/desactivar`,{})},async activar(e){return t.patch(`/conductores/${e}/activar`,{})},async eliminar(e){return t.delete(`/conductores/${e}`)},async obtenerDetalles(e){return t.get(`/conductores/${e}/detalles`)},async obtenerHistorial(e){return t.get(`/conductores/${e}/historial`)},async registrarHoras(e,r){return t.post(`/conductores/${e}/horas`,r)},async registrarAlerta(e,r){return t.post(`/conductores/${e}/alertas-fatiga`,{descripcion:r})}},S={async listar(){return t.get("/modulos/permisos")},async obtenerPorRol(e){return t.get(`/modulos/permisos/rol/${e}`)},async actualizarRol(e,r){return t.put(`/modulos/permisos/${e}`,{permisos:r})},async reset(){return t.post("/modulos/permisos/reset",{})}},w={async crear(e){return t.post("/clientes",e)},async listar(){return t.get("/clientes")},async obtener(e){return t.get(`/clientes/${e}`)},async actualizar(e,r){return t.put(`/clientes/${e}`,r)},async desactivar(e){return t.patch(`/clientes/${e}/desactivar`,{})},async activar(e){return t.patch(`/clientes/${e}/activar`,{})},async eliminar(e){return t.delete(`/clientes/${e}`)}},A={async crear(e){return t.post("/trayectos",e)},async listar(){return t.get("/trayectos")},async actualizar(e,r){return t.put(`/trayectos/${e}`,r)},async eliminar(e){return t.delete(`/trayectos/${e}`)},async asignarTrayecto(e){return t.post("/asignaciones",e)},async listarAsignaciones(){return t.get("/asignaciones")},async obtenerAsignacion(e){return t.get(`/asignaciones/${e}`)},async desasignarTrayecto(e){return t.delete(`/asignaciones/${e}`)},async actualizarAsignacion(e,r){return t.put(`/asignaciones/${e}`,r)}},d=a({token:l.getToken(),usuario:null,nombre_rol:null,isAuthenticated:l.isAuthenticated(),loading:!1,loggingOut:!1,error:null}),P=()=>{d.update(e=>({...e,loggingOut:!0})),l.logout(),typeof document<"u"&&(document.cookie="auth_token=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;"),d.update(e=>({...e,token:null,usuario:null,nombre_rol:null,isAuthenticated:!1,loggingOut:!1}))},E=e=>{d.update(r=>({...r,usuario:e||null,nombre_rol:e?.nombre_rol||null}))},_=a({items:[],loading:!1,error:null}),z=a({items:[],loading:!1,error:null}),D=a({items:[],loading:!1,error:null}),O=a({items:[],loading:!1,error:null}),q=a({items:[],loading:!1,error:null}),J=a({items:[],loading:!1,error:null}),j=a({items:[],loading:!1,error:null}),y=a([]),x=(e,r="info",n=3e3)=>{const s=Date.now(),i={id:s,mensaje:e,tipo:r};return y.update(c=>[...c,i]),n>0&&setTimeout(()=>{y.update(c=>c.filter(u=>u.id!==s))},n),s};export{q as a,x as b,D as c,J as d,b as e,k as f,A as g,w as h,d as i,l as j,v as k,_ as l,T as m,S as n,P as o,y as p,j as r,E as s,O as t,$ as u,z as v};
