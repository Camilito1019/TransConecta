import"../chunks/DsnmJJEf.js";import"../chunks/2J32lFCu.js";import{o as re,a as w,e as C}from"../chunks/D5sqcERo.js";import{at as oe,au as ca,av as ie,aq as n,aw as M,a as v,ax as le,b as a,W as h,r as ce,s as c,ay as ue,az as r,ar as t,as as s,u,aA as ya,aB as Y,c as Ua,f as wa,aC as ve,aa as Ca}from"../chunks/DdWuALZu.js";import{i as x}from"../chunks/DNIL3y1X.js";import{e as xa,i as Ea}from"../chunks/qLEJnVdX.js";import{h as me}from"../chunks/CgsUcASs.js";import{r as ka}from"../chunks/DjPkcCDc.js";import{s as ne}from"../chunks/D4-J_OgU.js";import{b as Na}from"../chunks/CnWbZhhT.js";import{b as Da}from"../chunks/pQeqK__H.js";import{p as de}from"../chunks/CdEA5IGF.js";import{i as fe}from"../chunks/-w5iKcy_.js";import{s as pe,a as $a}from"../chunks/B3jtdlFh.js";import{g as _e}from"../chunks/C07Td5iz.js";import{l as Z,b,u as O,k as be}from"../chunks/3qLZv7Rd.js";import{e as qa,m as he,a as ge,c as ye,d as Ue,p as we}from"../chunks/y7-MpCW8.js";import{s as Sa}from"../chunks/V8TKOVD4.js";var Ce=n('<button class="primary svelte-1cfum5m">+ Nuevo usuario</button>'),xe=n("<option> </option>"),Ee=n('<label class="field svelte-1cfum5m"><span>Estado</span> <select class="svelte-1cfum5m"><option>Activo</option><option>Inactivo</option></select></label>'),ke=n('<section class="panel svelte-1cfum5m"><div class="panel-head svelte-1cfum5m"><div><p class="label svelte-1cfum5m">Formulario</p> <h2 class="svelte-1cfum5m"> </h2></div> <button class="ghost svelte-1cfum5m">Cerrar</button></div> <form class="form-grid svelte-1cfum5m"><label class="field svelte-1cfum5m"><span>Nombre de usuario</span> <input type="text" placeholder="Ej. Juan Pérez" required class="svelte-1cfum5m"/></label> <label class="field svelte-1cfum5m"><span>Correo</span> <input type="email" placeholder="correo@empresa.com" required class="svelte-1cfum5m"/></label> <label class="field svelte-1cfum5m"><span>Rol</span> <select required class="svelte-1cfum5m"><option>Selecciona un rol</option><!></select></label> <!> <div class="form-actions svelte-1cfum5m"><button type="submit" class="primary svelte-1cfum5m">Guardar</button> <button type="button" class="ghost svelte-1cfum5m">Cancelar</button></div></form></section>'),Ne=n('<div class="loading svelte-1cfum5m"><div class="spinner svelte-1cfum5m"></div> <p>Cargando usuarios...</p></div>'),De=n('<div class="empty svelte-1cfum5m"><p>No hay usuarios registrados.</p></div>'),$e=n('<button class="ghost svelte-1cfum5m">Editar</button>'),qe=n('<button class="danger svelte-1cfum5m">Desactivar</button>'),Se=n('<button class="success svelte-1cfum5m">Activar</button>'),Ae=n('<button class="outline svelte-1cfum5m">Eliminar</button>'),Re=n('<tr class="svelte-1cfum5m"><td class="svelte-1cfum5m"> </td><td class="svelte-1cfum5m"> </td><td class="svelte-1cfum5m"><span class="pill svelte-1cfum5m"> </span></td><td class="svelte-1cfum5m"><span> </span></td><td class="svelte-1cfum5m"> </td><td class="actions svelte-1cfum5m"><!> <!> <!></td></tr>'),ze=n('<div class="table-wrap svelte-1cfum5m"><table class="svelte-1cfum5m"><thead class="svelte-1cfum5m"><tr class="svelte-1cfum5m"><th class="svelte-1cfum5m">Usuario</th><th class="svelte-1cfum5m">Correo</th><th class="svelte-1cfum5m">Rol</th><th class="svelte-1cfum5m">Estado</th><th class="svelte-1cfum5m">Creación</th><th class="svelte-1cfum5m"></th></tr></thead><tbody class="svelte-1cfum5m"></tbody></table></div>'),Me=n('<div class="modal-backdrop svelte-1cfum5m"><div class="modal svelte-1cfum5m"><p class="label svelte-1cfum5m">Confirmar</p> <h3 class="svelte-1cfum5m">¿Eliminar usuario?</h3> <p class="lede svelte-1cfum5m">Se eliminará <strong> </strong>. Esta acción no se puede deshacer.</p> <div class="modal-actions svelte-1cfum5m"><button class="ghost svelte-1cfum5m">Cancelar</button> <button class="danger svelte-1cfum5m">Eliminar</button></div></div></div>'),Fe=n('<div class="page-shell svelte-1cfum5m"><div class="bg-shape shape-a svelte-1cfum5m" aria-hidden="true"></div> <div class="bg-shape shape-b svelte-1cfum5m" aria-hidden="true"></div> <section class="hero svelte-1cfum5m"><div class="hero-text svelte-1cfum5m"><p class="eyebrow svelte-1cfum5m">Equipo</p> <h1 class="svelte-1cfum5m">Gestión de Usuarios</h1> <p class="lede svelte-1cfum5m">Administra cuentas, roles y estado operativo de tu equipo.</p> <div class="chips svelte-1cfum5m"><span class="chip success svelte-1cfum5m"> </span> <span class="chip muted svelte-1cfum5m"> </span></div></div> <div class="hero-actions svelte-1cfum5m"><!></div></section> <!> <section class="panel svelte-1cfum5m"><div class="panel-head svelte-1cfum5m"><div><p class="label svelte-1cfum5m">Listado</p> <h2 class="svelte-1cfum5m">Usuarios</h2></div></div> <!></section> <!></div>');function es(Aa,Ra){oe(Ra,!1);const ua=()=>$a(he,"$modulosConfig",va),g=()=>$a(Z,"$usuarios",va),[va,za]=pe(),aa=h(),P=h();let F=h(!1),G=h(null),E=h({open:!1,id:null,nombre:""}),o=h({nombre_usuario:"",correo:"",id_rol:"",estado:"activo"}),ea=h([]);const j="usuarios";let ma=h(!1),na=h(!1),da=h(!1),fa=h(!1);re(async()=>{if(!ge(j)){b("No tienes acceso al módulo Usuarios","error"),_e("/");return}await B()});async function B(){try{Z.update(p=>({...p,loading:!0}));const[e,i]=await Promise.all([O.listar(),be.listar()]);Z.update(p=>({...p,items:e.usuarios||[],loading:!1})),c(ea,i.roles||[])}catch(e){Z.update(i=>({...i,error:e.message,loading:!1})),b(e.message,"error")}}async function Ma(){c(G,null),c(o,{nombre_usuario:"",correo:"",id_rol:"",estado:"activo"}),c(F,!0),await Ca(),Sa()}async function Fa(e){c(G,e.id_usuario),c(o,{nombre_usuario:e.nombre_usuario,correo:e.correo,id_rol:e.id_rol,estado:e.estado}),c(F,!0),await Ca(),Sa()}async function Ga(){if(!a(o).nombre_usuario||!a(o).correo||!a(o).id_rol){b("Completa todos los campos","warning");return}try{a(G)?(await O.actualizar(a(G),{nombre_usuario:a(o).nombre_usuario,correo:a(o).correo,id_rol:Number(a(o).id_rol),estado:a(o).estado}),b("Usuario actualizado","success")):(await O.registrar(a(o).nombre_usuario,a(o).correo,Number(a(o).id_rol)),b("Usuario creado. Se envió un correo con las credenciales.","success")),c(F,!1),await B()}catch(e){b(e.message,"error")}}async function La(e){try{await O.inactivar(e),b("Usuario desactivado","success"),await B()}catch(i){b(i.message,"error")}}async function Ta(e){try{await O.activar(e),b("Usuario activado","success"),await B()}catch(i){b(i.message,"error")}}async function Ia(e){if(a(E).id)try{await O.eliminar(e),b("Usuario eliminado","success"),c(E,{open:!1,id:null,nombre:""}),await B()}catch(i){b(i.message,"error")}}ca(()=>ua(),()=>{c(aa,ua())}),ca(()=>(a(aa),qa),()=>{a(aa),c(ma,ye(j)),c(na,Ue(j)),c(da,we(j)),c(fa,qa(j))}),ca(()=>g(),()=>{c(P,{total:g().items.length,activos:g().items.filter(e=>e.estado==="activo").length,inactivos:g().items.filter(e=>e.estado==="inactivo").length})}),ie(),fe();var sa=Fe();me("1cfum5m",e=>{ce(()=>{ue.title="Gestión de Usuarios - TransConecta"})});var ta=r(t(sa),4),ra=t(ta),pa=r(t(ra),6),oa=t(pa),Oa=t(oa);s(oa);var _a=r(oa,2),Pa=t(_a);s(_a),s(pa),s(ra);var ba=r(ra,2),ja=t(ba);{var Ba=e=>{var i=Ce();C("click",i,Ma),v(e,i)};x(ja,e=>{a(ma)&&e(Ba)})}s(ba),s(ta);var ha=r(ta,2);{var Ja=e=>{var i=ke(),p=t(i),k=t(p),S=r(t(k),2),y=t(S,!0);s(S),s(k);var U=r(k,2);s(p);var N=r(p,2),D=t(N),H=r(t(D),2);ka(H),s(D);var l=r(D,2),L=r(t(l),2);ka(L),s(l);var A=r(l,2),J=r(t(A),2);M(()=>{a(o),ya(()=>{a(ea)})});var R=t(J);R.value=R.__value="";var la=r(R);xa(la,1,()=>a(ea),Ea,(m,_)=>{var d=xe(),z=t(d,!0);s(d);var $={};M(()=>{w(z,(a(_),u(()=>a(_).nombre_rol))),$!==($=(a(_),u(()=>a(_).id_rol)))&&(d.value=(d.__value=(a(_),u(()=>a(_).id_rol)))??"")}),v(m,d)}),s(J),s(A);var T=r(A,2);{var K=m=>{var _=Ee(),d=r(t(_),2);M(()=>{a(o),ya(()=>{})});var z=t(d);z.value=z.__value="activo";var $=r(z);$.value=$.__value="inactivo",s(d),s(_),Da(d,()=>a(o).estado,X=>Y(o,a(o).estado=X)),v(m,_)};x(T,m=>{a(G)&&m(K)})}var Q=r(T,2),V=r(t(Q),2);s(Q),s(N),s(i),M(()=>w(y,a(G)?"Editar usuario":"Nuevo usuario")),C("click",U,()=>c(F,!1)),Na(H,()=>a(o).nombre_usuario,m=>Y(o,a(o).nombre_usuario=m)),Na(L,()=>a(o).correo,m=>Y(o,a(o).correo=m)),Da(J,()=>a(o).id_rol,m=>Y(o,a(o).id_rol=m)),C("click",V,()=>c(F,!1)),C("submit",N,de(Ga)),v(e,i)};x(ha,e=>{a(F)&&e(Ja)})}var ia=r(ha,2),Va=r(t(ia),2);{var Wa=e=>{var i=Ne();v(e,i)},Ha=e=>{var i=Ua(),p=wa(i);{var k=y=>{var U=De();v(y,U)},S=y=>{var U=ze(),N=t(U),D=r(t(N));xa(D,5,()=>(g(),u(()=>g().items)),Ea,(H,l)=>{var L=Re(),A=t(L),J=t(A,!0);s(A);var R=r(A),la=t(R,!0);s(R);var T=r(R),K=t(T),Q=t(K,!0);s(K),s(T);var V=r(T),m=t(V),_=t(m,!0);s(m),s(V);var d=r(V),z=t(d,!0);s(d);var $=r(d),X=t($);{var Xa=f=>{var q=$e();C("click",q,()=>Fa(a(l))),v(f,q)};x(X,f=>{a(na)&&f(Xa)})}var ga=r(X,2);{var Ya=f=>{var q=Ua(),ee=wa(q);{var se=I=>{var W=qe();C("click",W,()=>La(a(l).id_usuario)),v(I,W)},te=I=>{var W=Se();C("click",W,()=>Ta(a(l).id_usuario)),v(I,W)};x(ee,I=>{a(l),u(()=>a(l).estado==="activo")?I(se):I(te,!1)})}v(f,q)};x(ga,f=>{a(fa)&&f(Ya)})}var Za=r(ga,2);{var ae=f=>{var q=Ae();C("click",q,()=>c(E,{open:!0,id:a(l).id_usuario,nombre:a(l).nombre_usuario})),v(f,q)};x(Za,f=>{a(da)&&f(ae)})}s($),s(L),M(f=>{w(J,(a(l),u(()=>a(l).nombre_usuario))),w(la,(a(l),u(()=>a(l).correo))),w(Q,(a(l),u(()=>a(l).nombre_rol||"N/A"))),ne(m,1,(a(l),u(()=>`status ${a(l).estado==="activo"?"green":"red"}`)),"svelte-1cfum5m"),w(_,(a(l),u(()=>a(l).estado))),w(z,f)},[()=>(a(l),u(()=>new Date(a(l).fecha_creacion).toLocaleDateString()))]),v(H,L)}),s(D),s(N),s(U),v(y,U)};x(p,y=>{g(),u(()=>g().items.length===0)?y(k):y(S,!1)},!0)}v(e,i)};x(Va,e=>{g(),u(()=>g().loading)?e(Wa):e(Ha,!1)})}s(ia);var Ka=r(ia,2);{var Qa=e=>{var i=Me(),p=t(i),k=r(t(p),4),S=r(t(k)),y=t(S,!0);s(S),ve(),s(k);var U=r(k,2),N=t(U),D=r(N,2);s(U),s(p),s(i),M(()=>w(y,(a(E),u(()=>a(E).nombre)))),C("click",N,()=>c(E,{open:!1,id:null,nombre:""})),C("click",D,()=>Ia(a(E).id)),v(e,i)};x(Ka,e=>{a(E),u(()=>a(E).open)&&e(Qa)})}s(sa),M(()=>{w(Oa,`${a(P),u(()=>a(P).activos)??""} activos`),w(Pa,`${a(P),u(()=>a(P).inactivos)??""} inactivos`)}),v(Aa,sa),le(),za()}export{es as component};
