import"../chunks/DsnmJJEf.js";import"../chunks/2J32lFCu.js";import{o as Ee,a as c,e as D}from"../chunks/D5sqcERo.js";import{at as Te,au as za,av as Ae,aq as v,aw as j,a as i,ax as Le,b as a,W as z,r as Me,s as _,ay as Oe,az as l,ar as s,as as e,u as r,aA as ze,aB as ca,c as Fa,f as ma,aC as Fe,aa as Ra,ao as Xa}from"../chunks/DdWuALZu.js";import{i as x}from"../chunks/DNIL3y1X.js";import{e as xa,i as fa}from"../chunks/qLEJnVdX.js";import{h as qe}from"../chunks/CgsUcASs.js";import{r as ba}from"../chunks/DjPkcCDc.js";import{s as Ge}from"../chunks/D4-J_OgU.js";import{b as ha}from"../chunks/CnWbZhhT.js";import{b as Ie}from"../chunks/pQeqK__H.js";import{p as He}from"../chunks/CdEA5IGF.js";import{i as Ve}from"../chunks/-w5iKcy_.js";import{s as je,a as Ya}from"../chunks/B3jtdlFh.js";import{g as Be}from"../chunks/C07Td5iz.js";import{c as Ca,b as F,f as X}from"../chunks/3qLZv7Rd.js";import{e as Za,m as Je,a as Pe,c as Ue,d as We,p as Ke}from"../chunks/y7-MpCW8.js";import{e as ae,a as ee}from"../chunks/BCA_XIn1.js";import{s as se}from"../chunks/V8TKOVD4.js";var Qe=v('<button class="primary svelte-dngsxy">+ Nuevo conductor</button>'),Re=v('<section class="panel svelte-dngsxy"><div class="panel-head svelte-dngsxy"><div><p class="label svelte-dngsxy">Formulario</p> <h2 class="svelte-dngsxy"> </h2></div> <button class="ghost svelte-dngsxy">Cerrar</button></div> <form class="form-grid svelte-dngsxy"><label class="field svelte-dngsxy"><span>Nombre</span> <input type="text" placeholder="Juan Pérez" required class="svelte-dngsxy"/></label> <label class="field svelte-dngsxy"><span>Cédula</span> <input type="text" placeholder="1234567890" required class="svelte-dngsxy"/></label> <label class="field svelte-dngsxy"><span>Teléfono</span> <input type="text" placeholder="3001234567" class="svelte-dngsxy"/></label> <label class="field svelte-dngsxy"><span>Licencia</span> <input type="text" placeholder="LIC-123456" class="svelte-dngsxy"/></label> <label class="field svelte-dngsxy"><span>Estado</span> <select class="svelte-dngsxy"><option>Activo</option><option>Inactivo</option></select></label> <div class="form-actions svelte-dngsxy"><button type="submit" class="primary svelte-dngsxy">Guardar</button> <button type="button" class="ghost svelte-dngsxy">Cancelar</button></div></form></section>'),Xe=v('<div class="loading svelte-dngsxy"><div class="spinner svelte-dngsxy"></div> <p>Cargando conductores...</p></div>'),Ye=v('<div class="empty svelte-dngsxy"><p>No hay conductores registrados.</p></div>'),Ze=v('<button class="ghost svelte-dngsxy">Editar</button>'),as=v('<button class="success svelte-dngsxy">Activar</button>'),es=v('<button class="danger svelte-dngsxy">Desactivar</button>'),ss=v('<button class="outline svelte-dngsxy">Eliminar</button>'),ts=v('<tr class="svelte-dngsxy"><td class="svelte-dngsxy"> </td><td class="svelte-dngsxy"> </td><td class="svelte-dngsxy"> </td><td class="svelte-dngsxy"> </td><td class="svelte-dngsxy"><span> </span></td><td class="actions svelte-dngsxy"><button class="ghost svelte-dngsxy">Ver</button> <!> <!> <!></td></tr>'),ls=v('<div class="table-wrap svelte-dngsxy"><table class="svelte-dngsxy"><thead class="svelte-dngsxy"><tr class="svelte-dngsxy"><th class="svelte-dngsxy">Nombre</th><th class="svelte-dngsxy">Cédula</th><th class="svelte-dngsxy">Teléfono</th><th class="svelte-dngsxy">Licencia</th><th class="svelte-dngsxy">Estado</th><th class="svelte-dngsxy"></th></tr></thead><tbody class="svelte-dngsxy"></tbody></table></div>'),rs=v('<div class="modal-backdrop svelte-dngsxy"><div class="modal svelte-dngsxy"><p class="label svelte-dngsxy">Confirmar</p> <h3 class="svelte-dngsxy"> </h3> <p class="lede svelte-dngsxy"> <strong> </strong>.</p> <div class="modal-actions svelte-dngsxy"><button class="ghost svelte-dngsxy">Cancelar</button> <button class="danger svelte-dngsxy">Confirmar</button></div></div></div>'),os=v('<p class="lede svelte-dngsxy">Cargando...</p>'),ns=v('<span class="muted svelte-dngsxy"> </span>'),ds=v('<li class="svelte-dngsxy"><div><strong> </strong> </div> <!></li>'),is=v('<div class="list-scroll svelte-dngsxy"><ul class="lined svelte-dngsxy"></ul></div>'),vs=v('<p class="muted svelte-dngsxy">Sin registros</p>'),cs=v('<li class="svelte-dngsxy"><strong> </strong> </li>'),us=v('<div class="list-scroll svelte-dngsxy"><ul class="lined svelte-dngsxy"></ul></div>'),ps=v('<p class="muted svelte-dngsxy">Sin alertas</p>'),gs=v('<li class="svelte-dngsxy"><strong> </strong> </li>'),_s=v('<div class="list-scroll svelte-dngsxy"><ul class="lined svelte-dngsxy"></ul></div>'),ys=v('<p class="muted svelte-dngsxy">Sin historial</p>'),ms=v('<h3 class="svelte-dngsxy"> </h3> <p class="lede small svelte-dngsxy"> </p> <div class="detail-scroll svelte-dngsxy"><div class="detail-grid top-row svelte-dngsxy"><div class="card svelte-dngsxy"><div class="card-head svelte-dngsxy"><h4 class="svelte-dngsxy">Horas de conducción</h4> <span class="pill svelte-dngsxy"> </span></div> <!></div> <div class="card svelte-dngsxy"><div class="card-head svelte-dngsxy"><h4 class="svelte-dngsxy">Alertas de fatiga</h4> <span class="pill warning svelte-dngsxy"> </span></div> <!></div></div> <div class="card full wide svelte-dngsxy"><div class="card-head svelte-dngsxy"><h4 class="svelte-dngsxy">Historial</h4> <span class="pill muted-pill svelte-dngsxy"> </span></div> <!></div></div>',1),xs=v('<div class="modal-backdrop svelte-dngsxy"><div class="modal wide svelte-dngsxy"><p class="label svelte-dngsxy">Detalle de conductor</p> <!> <div class="modal-actions svelte-dngsxy"><button class="ghost svelte-dngsxy">Cerrar</button></div></div></div>'),fs=v('<div class="page-shell svelte-dngsxy"><div class="bg-shape shape-a svelte-dngsxy" aria-hidden="true"></div> <div class="bg-shape shape-b svelte-dngsxy" aria-hidden="true"></div> <section class="hero svelte-dngsxy"><div class="hero-text svelte-dngsxy"><p class="eyebrow svelte-dngsxy">Operaciones</p> <h1 class="svelte-dngsxy">Gestión de Conductores</h1> <p class="lede svelte-dngsxy">Administra conductores, licencias y estado operativo.</p> <div class="chips svelte-dngsxy"><span class="chip success svelte-dngsxy"> </span> <span class="chip muted svelte-dngsxy"> </span></div></div> <div class="hero-actions svelte-dngsxy"><!></div></section> <!> <section class="panel svelte-dngsxy"><div class="panel-head svelte-dngsxy"><div><p class="label svelte-dngsxy">Listado</p> <h2 class="svelte-dngsxy">Conductores</h2></div></div> <!></section> <!> <!></div>');function Is(te,le){Te(le,!1);const qa=()=>Ya(Je,"$modulosConfig",Ga),q=()=>Ya(Ca,"$conductores",Ga),[Ga,re]=je(),wa=z(),aa=z();let Y=z(!1),ea=z(null),y=z({open:!1,type:null,id:null,label:""}),o=z({open:!1,data:null,loading:!1}),u=z({nombre:"",cedula:"",telefono:"",licencia_conduccion:"",estado:"activo"});const sa="conductores";let Ia=z(!1),Ha=z(!1),Va=z(!1),ja=z(!1);const Ba=t=>{if(!t)return"—";const n=new Date(t),f=n.getTime();return Number.isNaN(f)?t:n.toLocaleString("es-CO",{dateStyle:"medium",timeStyle:"short"})},oe=t=>{if(!t)return"—";const n=new Date(t),f=n.getTime();return Number.isNaN(f)?t:n.toLocaleDateString("es-CO",{dateStyle:"medium"})},Ja=t=>t?t.toString().slice(0,8):"";Ee(async()=>{if(!Pe(sa)){F("No tienes acceso al módulo Conductores","error"),Be("/");return}await ka()});async function ne(t){_(o,{open:!0,data:null,loading:!0});try{const n=await X.obtenerDetalles(t.id_conductor);_(o,{open:!0,data:n,loading:!1})}catch{F("No se pudo cargar el detalle","error"),_(o,{open:!1,data:null,loading:!1})}}async function ka(){Ca.update(t=>({...t,loading:!0}));try{const t=await X.listar();Ca.update(n=>({...n,items:t.conductores||[],loading:!1}))}catch(t){Ca.update(n=>({...n,error:t.message,loading:!1})),F(t.message,"error")}}function de(){_(ea,null),_(u,{nombre:"",cedula:"",telefono:"",licencia_conduccion:"",estado:"activo"})}async function ie(){de(),_(Y,!0),await Ra(),se()}async function ve(t){_(ea,t.id_conductor),_(u,{nombre:t.nombre||"",cedula:t.cedula||"",telefono:t.telefono||"",licencia_conduccion:t.licencia_conduccion||"",estado:t.estado||"activo"}),_(Y,!0),await Ra(),se()}async function ce(){if(!a(u).nombre||!a(u).cedula){F("Completa nombre y cédula","warning");return}try{a(ea)?(await X.actualizar(a(ea),a(u)),F("Conductor actualizado","success")):(await X.crear(a(u)),F("Conductor creado","success")),_(Y,!1),await ka()}catch(t){F(t.message,"error")}}function $a(t,n){_(y,{open:!0,type:t,id:n.id_conductor,label:n.nombre})}async function ue(){if(!(!a(y).id||!a(y).type))try{a(y).type==="eliminar"?(await X.eliminar(a(y).id),F("Conductor eliminado","success")):a(y).type==="desactivar"?(await X.desactivar(a(y).id),F("Conductor desactivado","success")):a(y).type==="activar"&&(await X.activar(a(y).id),F("Conductor activado","success")),_(y,{open:!1,type:null,id:null,label:""}),await ka()}catch(t){F(t.message,"error")}}za(()=>qa(),()=>{_(wa,qa())}),za(()=>(a(wa),Za),()=>{a(wa),_(Ia,Ue(sa)),_(Ha,We(sa)),_(Va,Ke(sa)),_(ja,Za(sa))}),za(()=>q(),()=>{_(aa,{total:q().items.length,activos:q().items.filter(t=>t.estado==="activo").length,inactivos:q().items.filter(t=>t.estado==="inactivo").length})}),Ae(),Ve();var Na=fs();qe("dngsxy",t=>{Me(()=>{Oe.title="Gestión de Conductores - TransConecta"})});var Sa=l(s(Na),4),Da=s(Sa),Pa=l(s(Da),6),Ea=s(Pa),pe=s(Ea);e(Ea);var Ua=l(Ea,2),ge=s(Ua);e(Ua),e(Pa),e(Da);var Wa=l(Da,2),_e=s(Wa);{var ye=t=>{var n=Qe();D("click",n,ie),i(t,n)};x(_e,t=>{a(Ia)&&t(ye)})}e(Wa),e(Sa);var Ka=l(Sa,2);{var me=t=>{var n=Re(),f=s(n),$=s(f),P=l(s($),2),C=s(P,!0);e(P),e($);var k=l($,2);e(f);var E=l(f,2),b=s(E),N=l(s(b),2);ba(N),e(b);var d=l(b,2),G=l(s(d),2);ba(G),e(d);var T=l(d,2),W=l(s(T),2);ba(W),e(T);var A=l(T,2),Z=l(s(A),2);ba(Z),e(A);var L=l(A,2),K=l(s(L),2);j(()=>{a(u),ze(()=>{})});var I=s(K);I.value=I.__value="activo";var U=l(I);U.value=U.__value="inactivo",e(K),e(L);var H=l(L,2),B=l(s(H),2);e(H),e(E),e(n),j(()=>c(C,a(ea)?"Editar conductor":"Nuevo conductor")),D("click",k,()=>_(Y,!1)),ha(N,()=>a(u).nombre,w=>ca(u,a(u).nombre=w)),ha(G,()=>a(u).cedula,w=>ca(u,a(u).cedula=w)),ha(W,()=>a(u).telefono,w=>ca(u,a(u).telefono=w)),ha(Z,()=>a(u).licencia_conduccion,w=>ca(u,a(u).licencia_conduccion=w)),Ie(K,()=>a(u).estado,w=>ca(u,a(u).estado=w)),D("click",B,()=>_(Y,!1)),D("submit",E,He(ce)),i(t,n)};x(Ka,t=>{a(Y)&&t(me)})}var Ta=l(Ka,2),xe=l(s(Ta),2);{var fe=t=>{var n=Xe();i(t,n)},be=t=>{var n=Fa(),f=ma(n);{var $=C=>{var k=Ye();i(C,k)},P=C=>{var k=ls(),E=s(k),b=l(s(E));xa(b,5,()=>(q(),r(()=>q().items)),fa,(N,d)=>{var G=ts(),T=s(G),W=s(T,!0);e(T);var A=l(T),Z=s(A,!0);e(A);var L=l(A),K=s(L,!0);e(L);var I=l(L),U=s(I,!0);e(I);var H=l(I),B=s(H),w=s(B,!0);e(B),e(H);var ua=l(H),pa=s(ua),ga=l(pa,2);{var Aa=h=>{var S=Ze();D("click",S,()=>ve(a(d))),i(h,S)};x(ga,h=>{a(Ha)&&h(Aa)})}var ta=l(ga,2);{var la=h=>{var S=Fa(),Ma=ma(S);{var ya=J=>{var Q=as();D("click",Q,()=>$a("activar",a(d))),i(J,Q)},ra=J=>{var Q=es();D("click",Q,()=>$a("desactivar",a(d))),i(J,Q)};x(Ma,J=>{a(d),r(()=>a(d).estado==="inactivo")?J(ya):J(ra,!1)})}i(h,S)};x(ta,h=>{a(ja)&&h(la)})}var _a=l(ta,2);{var La=h=>{var S=ss();D("click",S,()=>$a("eliminar",a(d))),i(h,S)};x(_a,h=>{a(Va)&&h(La)})}e(ua),e(G),j((h,S)=>{c(W,(a(d),r(()=>a(d).nombre))),c(Z,(a(d),r(()=>a(d).cedula))),c(K,(a(d),r(()=>a(d).telefono||"—"))),c(U,(a(d),r(()=>a(d).licencia_conduccion||"—"))),Ge(B,1,h,"svelte-dngsxy"),c(w,S)},[()=>(Xa(ae),a(d),r(()=>`status-pill status-${ae(a(d).estado)}`)),()=>(Xa(ee),a(d),r(()=>ee(a(d).estado)))]),D("click",pa,()=>ne(a(d))),i(N,G)}),e(b),e(E),e(k),i(C,k)};x(f,C=>{q(),r(()=>q().items.length===0)?C($):C(P,!1)},!0)}i(t,n)};x(xe,t=>{q(),r(()=>q().loading)?t(fe):t(be,!1)})}e(Ta);var Qa=l(Ta,2);{var he=t=>{var n=rs(),f=s(n),$=l(s(f),2),P=s($,!0);e($);var C=l($,2),k=s(C),E=l(k),b=s(E,!0);e(E),Fe(),e(C);var N=l(C,2),d=s(N),G=l(d,2);e(N),e(f),e(n),j(()=>{c(P,(a(y),r(()=>a(y).type==="eliminar"?"¿Eliminar conductor?":a(y).type==="desactivar"?"¿Desactivar conductor?":"¿Activar conductor?"))),c(k,`${a(y),r(()=>a(y).type==="eliminar"?"Se eliminará ":a(y).type==="desactivar"?"Se marcará inactivo ":"Se marcará activo ")??""} `),c(b,(a(y),r(()=>a(y).label)))}),D("click",d,()=>_(y,{open:!1,type:null,id:null,label:""})),D("click",G,ue),i(t,n)};x(Qa,t=>{a(y),r(()=>a(y).open)&&t(he)})}var Ce=l(Qa,2);{var we=t=>{var n=xs(),f=s(n),$=l(s(f),2);{var P=b=>{var N=os();i(b,N)},C=b=>{var N=Fa(),d=ma(N);{var G=T=>{var W=ms(),A=ma(W),Z=s(A,!0);e(A);var L=l(A,2),K=s(L);e(L);var I=l(L,2),U=s(I),H=s(U),B=s(H),w=l(s(B),2),ua=s(w);e(w),e(B);var pa=l(B,2);{var ga=p=>{var m=is(),V=s(m);xa(V,5,()=>(a(o),r(()=>(a(o).data.horas_conduccion||[]).slice(0,5))),fa,(oa,g)=>{var M=ds(),O=s(M),R=s(O),na=s(R,!0);e(R);var da=l(R);e(O);var Se=l(O,2);{var De=ia=>{var va=ns(),Oa=s(va,!0);e(va),j(()=>c(Oa,(a(g),r(()=>a(g).observaciones)))),i(ia,va)};x(Se,ia=>{a(g),r(()=>a(g).observaciones)&&ia(De)})}e(M),j((ia,va,Oa)=>{c(na,ia),c(da,` • ${va??""} - ${Oa??""} (${a(g),r(()=>a(g).horas_manejadas)??""} h)`)},[()=>(a(g),r(()=>oe(a(g).fecha))),()=>(a(g),r(()=>Ja(a(g).hora_inicio))),()=>(a(g),r(()=>Ja(a(g).hora_fin)))]),i(oa,M)}),e(V),e(m),i(p,m)},Aa=p=>{var m=vs();i(p,m)};x(pa,p=>{a(o),r(()=>a(o).data.horas_conduccion?.length)?p(ga):p(Aa,!1)})}e(H);var ta=l(H,2),la=s(ta),_a=l(s(la),2),La=s(_a);e(_a),e(la);var h=l(la,2);{var S=p=>{var m=us(),V=s(m);xa(V,5,()=>(a(o),r(()=>(a(o).data.alertas||[]).slice(0,5))),fa,(oa,g)=>{var M=cs(),O=s(M),R=s(O,!0);e(O);var na=l(O);e(M),j(da=>{c(R,da),c(na,` • ${a(g),r(()=>a(g).descripcion)??""}`)},[()=>(a(g),r(()=>Ba(a(g).fecha_alerta)))]),i(oa,M)}),e(V),e(m),i(p,m)},Ma=p=>{var m=ps();i(p,m)};x(h,p=>{a(o),r(()=>a(o).data.alertas?.length)?p(S):p(Ma,!1)})}e(ta),e(U);var ya=l(U,2),ra=s(ya),J=l(s(ra),2),Q=s(J);e(J),e(ra);var ke=l(ra,2);{var $e=p=>{var m=_s(),V=s(m);xa(V,5,()=>(a(o),r(()=>(a(o).data.historial||[]).slice(0,5))),fa,(oa,g)=>{var M=gs(),O=s(M),R=s(O,!0);e(O);var na=l(O);e(M),j(da=>{c(R,da),c(na,` • ${a(g),r(()=>a(g).evento)??""}`)},[()=>(a(g),r(()=>Ba(a(g).fecha_evento)))]),i(oa,M)}),e(V),e(m),i(p,m)},Ne=p=>{var m=ys();i(p,m)};x(ke,p=>{a(o),r(()=>a(o).data.historial?.length)?p($e):p(Ne,!1)})}e(ya),e(I),j((p,m,V)=>{c(Z,(a(o),r(()=>a(o).data.conductor?.nombre||"Conductor"))),c(K,`Cédula: ${a(o),r(()=>a(o).data.conductor?.cedula)??""} • Teléfono: ${a(o),r(()=>a(o).data.conductor?.telefono||"—")??""} • Licencia: ${a(o),r(()=>a(o).data.conductor?.licencia_conduccion||"—")??""}`),c(ua,`${p??""} / ${a(o),r(()=>a(o).data.total_horas)??""}`),c(La,`${m??""} / ${a(o),r(()=>a(o).data.total_alertas)??""}`),c(Q,`${V??""} / ${a(o),r(()=>a(o).data.total_eventos)??""}`)},[()=>(a(o),r(()=>Math.min(a(o).data.horas_conduccion?.length||0,5))),()=>(a(o),r(()=>Math.min(a(o).data.alertas?.length||0,5))),()=>(a(o),r(()=>Math.min(a(o).data.historial?.length||0,5)))]),i(T,W)};x(d,T=>{a(o),r(()=>a(o).data)&&T(G)},!0)}i(b,N)};x($,b=>{a(o),r(()=>a(o).loading)?b(P):b(C,!1)})}var k=l($,2),E=s(k);e(k),e(f),e(n),D("click",E,()=>_(o,{open:!1,data:null,loading:!1})),i(t,n)};x(Ce,t=>{a(o),r(()=>a(o).open)&&t(we)})}e(Na),j(()=>{c(pe,`${a(aa),r(()=>a(aa).activos)??""} activos`),c(ge,`${a(aa),r(()=>a(aa).inactivos)??""} inactivos`)}),i(te,Na),Le(),re()}export{Is as component};
