import"../chunks/DsnmJJEf.js";import"../chunks/2J32lFCu.js";import{o as Bs,a as k,e as T}from"../chunks/D5sqcERo.js";import{at as Is,au as ss,av as Rs,aq as p,aw as I,a as d,ax as Us,b as e,W as b,r as Vs,u as v,ar as t,az as i,s as l,ay as Ws,as as a,aB as R,c as js,f as Hs,aC as Js,aa as gs}from"../chunks/DdWuALZu.js";import{i as N}from"../chunks/DNIL3y1X.js";import{e as Ks,i as Ps}from"../chunks/qLEJnVdX.js";import{h as Qs}from"../chunks/CgsUcASs.js";import{r as U}from"../chunks/DjPkcCDc.js";import{b as V}from"../chunks/CnWbZhhT.js";import{p as Xs}from"../chunks/CdEA5IGF.js";import{i as Ys}from"../chunks/-w5iKcy_.js";import{s as Zs,a as ms}from"../chunks/B3jtdlFh.js";import{g as se}from"../chunks/C07Td5iz.js";import{t as W,b as C,g as j}from"../chunks/3qLZv7Rd.js";import{p as ps,m as ee,a as ae,c as te,d as ie}from"../chunks/y7-MpCW8.js";import{s as us}from"../chunks/V8TKOVD4.js";var re=p('<button class="primary svelte-s46ggx">+ Nuevo trayecto</button>'),oe=p('<section class="panel svelte-s46ggx"><div class="panel-head svelte-s46ggx"><div><p class="label svelte-s46ggx">Formulario</p> <h2 class="svelte-s46ggx"> </h2></div> <button class="ghost svelte-s46ggx">Cerrar</button></div> <form class="form-grid svelte-s46ggx"><label class="field svelte-s46ggx"><span>Origen</span> <input type="text" placeholder="Ciudad origen" required class="svelte-s46ggx"/></label> <label class="field svelte-s46ggx"><span>Destino</span> <input type="text" placeholder="Ciudad destino" required class="svelte-s46ggx"/></label> <label class="field svelte-s46ggx"><span>Distancia (km)</span> <input type="number" min="0" step="0.1" placeholder="0" required class="svelte-s46ggx"/></label> <label class="field svelte-s46ggx"><span>Tiempo estimado (h)</span> <input type="number" min="0" step="0.1" placeholder="0" required class="svelte-s46ggx"/></label> <div class="form-actions svelte-s46ggx"><button type="submit" class="primary svelte-s46ggx">Guardar</button> <button type="button" class="ghost svelte-s46ggx">Cancelar</button></div></form></section>'),le=p('<div class="loading svelte-s46ggx"><div class="spinner svelte-s46ggx"></div> <p>Cargando trayectos...</p></div>'),ne=p('<div class="empty svelte-s46ggx"><p>No hay trayectos registrados.</p></div>'),ce=p('<button class="ghost svelte-s46ggx">Editar</button>'),de=p('<button class="outline svelte-s46ggx">Eliminar</button>'),ve=p('<tr class="svelte-s46ggx"><td class="svelte-s46ggx"> </td><td class="svelte-s46ggx"> </td><td class="svelte-s46ggx"> </td><td class="svelte-s46ggx"> </td><td class="actions svelte-s46ggx"><!> <!></td></tr>'),ge=p('<div class="table-wrap svelte-s46ggx"><table class="svelte-s46ggx"><thead class="svelte-s46ggx"><tr class="svelte-s46ggx"><th class="svelte-s46ggx">Origen</th><th class="svelte-s46ggx">Destino</th><th class="svelte-s46ggx">Distancia</th><th class="svelte-s46ggx">Tiempo</th><th class="svelte-s46ggx"></th></tr></thead><tbody class="svelte-s46ggx"></tbody></table></div>'),me=p('<div class="modal-backdrop svelte-s46ggx"><div class="modal svelte-s46ggx"><p class="label svelte-s46ggx">Confirmar</p> <h3 class="svelte-s46ggx">¿Eliminar trayecto?</h3> <p class="lede svelte-s46ggx">Se eliminará <strong> </strong>.</p> <div class="modal-actions svelte-s46ggx"><button class="ghost svelte-s46ggx">Cancelar</button> <button class="danger svelte-s46ggx">Confirmar</button></div></div></div>'),pe=p('<div class="page-shell svelte-s46ggx"><div class="bg-shape shape-a svelte-s46ggx" aria-hidden="true"></div> <div class="bg-shape shape-b svelte-s46ggx" aria-hidden="true"></div> <section class="hero svelte-s46ggx"><div class="hero-text svelte-s46ggx"><p class="eyebrow svelte-s46ggx">Rutas</p> <h1 class="svelte-s46ggx">Gestión de Trayectos</h1> <p class="lede svelte-s46ggx">Define rutas con origen, destino, distancia y tiempo estimado.</p> <div class="chips svelte-s46ggx"><span class="chip success svelte-s46ggx"> </span> <span class="chip muted svelte-s46ggx"> </span></div></div> <div class="hero-actions svelte-s46ggx"><!></div></section> <!> <section class="panel svelte-s46ggx"><div class="panel-head svelte-s46ggx"><div><p class="label svelte-s46ggx">Listado</p> <h2 class="svelte-s46ggx">Trayectos</h2></div></div> <!></section> <!></div>');function Fe(_s,fs){Is(fs,!1);const es=()=>ms(ee,"$modulosConfig",as),u=()=>ms(W,"$trayectos",as),[as,xs]=Zs(),H=b(),O=b();let q=b(!1),z=b(null),_=b({open:!1,id:null,label:""}),o=b({origen:"",destino:"",distancia_km:"",tiempo_estimado:""});const L="trayectos";let ts=b(!1),is=b(!1),rs=b(!1);Bs(async()=>{if(!ae(L)){C("No tienes acceso al módulo Trayectos","error"),se("/");return}await J()});async function J(){W.update(s=>({...s,loading:!0}));try{const s=await j.listar();W.update(r=>({...r,items:s.trayectos||[],loading:!1}))}catch(s){W.update(r=>({...r,error:s.message,loading:!1})),C(s.message,"error")}}function bs(){l(z,null),l(o,{origen:"",destino:"",distancia_km:"",tiempo_estimado:""})}async function hs(){bs(),l(q,!0),await gs(),us()}async function ys(s){l(z,s.id_trayecto),l(o,{origen:s.origen,destino:s.destino,distancia_km:s.distancia_km,tiempo_estimado:s.tiempo_estimado}),l(q,!0),await gs(),us()}async function ks(){if(!e(o).origen||!e(o).destino||!e(o).distancia_km||!e(o).tiempo_estimado){C("Completa todos los campos","warning");return}const s={origen:e(o).origen,destino:e(o).destino,distancia_km:Number(e(o).distancia_km),tiempo_estimado:Number(e(o).tiempo_estimado)};try{e(z)?(await j.actualizar(e(z),s),C("Trayecto actualizado","success")):(await j.crear(s),C("Trayecto creado","success")),l(q,!1),await J()}catch(r){C(r.message,"error")}}function Ts(s){l(_,{open:!0,id:s.id_trayecto,label:`${s.origen} → ${s.destino}`})}async function Cs(){if(e(_).id)try{await j.eliminar(e(_).id),C("Trayecto eliminado","success"),l(_,{open:!1,id:null,label:""}),await J()}catch(s){C(s.message,"error")}}ss(()=>es(),()=>{l(H,es())}),ss(()=>(e(H),ps),()=>{e(H),l(ts,te(L)),l(is,ie(L)),l(rs,ps(L))}),ss(()=>u(),()=>{l(O,{total:u().items.length,distanciaTotal:u().items.reduce((s,r)=>s+Number(r.distancia_km||0),0)})}),Rs(),Ys();var K=pe();Qs("s46ggx",s=>{Vs(()=>{Ws.title="Gestión de Trayectos - TransConecta"})});var P=i(t(K),4),Q=t(P),os=i(t(Q),6),X=t(os),ws=t(X);a(X);var ls=i(X,2),$s=t(ls);a(ls),a(os),a(Q);var ns=i(Q,2),Es=t(ns);{var Ds=s=>{var r=re();T("click",r,hs),d(s,r)};N(Es,s=>{e(ts)&&s(Ds)})}a(ns),a(P);var cs=i(P,2);{var Ns=s=>{var r=oe(),h=t(r),f=t(h),w=i(t(f),2),g=t(w,!0);a(w),a(f);var m=i(f,2);a(h);var x=i(h,2),y=t(x),S=i(t(y),2);U(S),a(y);var n=i(y,2),F=i(t(n),2);U(F),a(n);var $=i(n,2),A=i(t($),2);U(A),a($);var E=i($,2),B=i(t(E),2);U(B),a(E);var M=i(E,2),Z=i(t(M),2);a(M),a(x),a(r),I(()=>k(g,e(z)?"Editar trayecto":"Nuevo trayecto")),T("click",m,()=>l(q,!1)),V(S,()=>e(o).origen,c=>R(o,e(o).origen=c)),V(F,()=>e(o).destino,c=>R(o,e(o).destino=c)),V(A,()=>e(o).distancia_km,c=>R(o,e(o).distancia_km=c)),V(B,()=>e(o).tiempo_estimado,c=>R(o,e(o).tiempo_estimado=c)),T("click",Z,()=>l(q,!1)),T("submit",x,Xs(ks)),d(s,r)};N(cs,s=>{e(q)&&s(Ns)})}var Y=i(cs,2),qs=i(t(Y),2);{var Fs=s=>{var r=le();d(s,r)},Ms=s=>{var r=js(),h=Hs(r);{var f=g=>{var m=ne();d(g,m)},w=g=>{var m=ge(),x=t(m),y=i(t(x));Ks(y,5,()=>(u(),v(()=>u().items)),Ps,(S,n)=>{var F=ve(),$=t(F),A=t($,!0);a($);var E=i($),B=t(E,!0);a(E);var M=i(E),Z=t(M);a(M);var c=i(M),Gs=t(c);a(c);var ds=i(c),vs=t(ds);{var Ls=D=>{var G=ce();T("click",G,()=>ys(e(n))),d(D,G)};N(vs,D=>{e(is)&&D(Ls)})}var Ss=i(vs,2);{var As=D=>{var G=de();T("click",G,()=>Ts(e(n))),d(D,G)};N(Ss,D=>{e(rs)&&D(As)})}a(ds),a(F),I(()=>{k(A,(e(n),v(()=>e(n).origen))),k(B,(e(n),v(()=>e(n).destino))),k(Z,`${e(n),v(()=>e(n).distancia_km)??""} km`),k(Gs,`${e(n),v(()=>e(n).tiempo_estimado)??""} h`)}),d(S,F)}),a(y),a(x),a(m),d(g,m)};N(h,g=>{u(),v(()=>u().items.length===0)?g(f):g(w,!1)},!0)}d(s,r)};N(qs,s=>{u(),v(()=>u().loading)?s(Fs):s(Ms,!1)})}a(Y);var Os=i(Y,2);{var zs=s=>{var r=me(),h=t(r),f=i(t(h),4),w=i(t(f)),g=t(w,!0);a(w),Js(),a(f);var m=i(f,2),x=t(m),y=i(x,2);a(m),a(h),a(r),I(()=>k(g,(e(_),v(()=>e(_).label)))),T("click",x,()=>l(_,{open:!1,id:null,label:""})),T("click",y,Cs),d(s,r)};N(Os,s=>{e(_),v(()=>e(_).open)&&s(zs)})}a(K),I(s=>{k(ws,`${e(O),v(()=>e(O).total)??""} trayectos`),k($s,`${s??""} km totales`)},[()=>(e(O),v(()=>e(O).distanciaTotal.toFixed(1)))]),d(_s,K),Us(),xs()}export{Fe as component};
