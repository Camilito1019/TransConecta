import"../chunks/DsnmJJEf.js";import"../chunks/2J32lFCu.js";import{o as Ne,a as q,e as h}from"../chunks/D5sqcERo.js";import{at as Me,au as K,av as qe,aq as u,aw as G,a as c,ax as ze,b as e,W as b,r as Fe,s as o,ay as Ge,az as r,ar as t,as as s,u as y,aD as Te,aB as ie,c as Ae,f as Le,aC as Oe,aa as oe}from"../chunks/DdWuALZu.js";import{i as C}from"../chunks/DNIL3y1X.js";import{e as Se,i as Be}from"../chunks/qLEJnVdX.js";import{h as Ie}from"../chunks/CgsUcASs.js";import{r as Pe}from"../chunks/DjPkcCDc.js";import{b as le}from"../chunks/CnWbZhhT.js";import{p as Ue}from"../chunks/CdEA5IGF.js";import{i as Ve}from"../chunks/-w5iKcy_.js";import{s as We,a as ne}from"../chunks/B3jtdlFh.js";import{g as He}from"../chunks/C07Td5iz.js";import{r as T,b as x,k as A}from"../chunks/3qLZv7Rd.js";import{b as L,m as Je,a as Ke}from"../chunks/y7-MpCW8.js";import{s as ce}from"../chunks/V8TKOVD4.js";var Qe=u('<button class="primary svelte-1gunji">+ Nuevo rol</button>'),Xe=u('<section class="panel svelte-1gunji"><div class="panel-head svelte-1gunji"><div><p class="label svelte-1gunji">Formulario</p> <h2 class="svelte-1gunji"> </h2></div> <button class="ghost svelte-1gunji">Cerrar</button></div> <form class="form-grid svelte-1gunji"><label class="field svelte-1gunji"><span>Nombre del rol</span> <input type="text" placeholder="Ej. Administrador" required class="svelte-1gunji"/></label> <label class="field svelte-1gunji"><span>Descripción</span> <textarea placeholder="Describe responsabilidades" class="svelte-1gunji"></textarea></label> <div class="form-actions svelte-1gunji"><button type="submit" class="primary svelte-1gunji">Guardar</button> <button type="button" class="ghost svelte-1gunji">Cancelar</button></div></form></section>'),Ye=u('<div class="loading svelte-1gunji"><div class="spinner svelte-1gunji"></div> <p>Cargando roles...</p></div>'),Ze=u('<div class="empty svelte-1gunji"><p>No hay roles registrados.</p></div>'),ea=u('<button class="ghost svelte-1gunji">Editar</button>'),aa=u('<button class="danger svelte-1gunji">Eliminar</button>'),sa=u('<tr class="svelte-1gunji"><td class="svelte-1gunji"> </td><td class="svelte-1gunji"> </td><td class="actions svelte-1gunji"><!> <!></td></tr>'),ta=u('<div class="table-wrap svelte-1gunji"><table class="svelte-1gunji"><thead class="svelte-1gunji"><tr class="svelte-1gunji"><th class="svelte-1gunji">Nombre</th><th class="svelte-1gunji">Descripción</th><th class="svelte-1gunji"></th></tr></thead><tbody class="svelte-1gunji"></tbody></table></div>'),ra=u('<div class="modal-backdrop svelte-1gunji"><div class="modal svelte-1gunji"><p class="label svelte-1gunji">Confirmar</p> <h3 class="svelte-1gunji">¿Eliminar rol?</h3> <p class="lede svelte-1gunji">Se eliminará <strong> </strong>. Esta acción no se puede deshacer.</p> <div class="modal-actions svelte-1gunji"><button class="ghost svelte-1gunji">Cancelar</button> <button class="danger svelte-1gunji">Eliminar</button></div></div></div>'),ia=u('<div class="page-shell svelte-1gunji"><div class="bg-shape shape-a svelte-1gunji" aria-hidden="true"></div> <div class="bg-shape shape-b svelte-1gunji" aria-hidden="true"></div> <section class="hero svelte-1gunji"><div class="hero-text svelte-1gunji"><p class="eyebrow svelte-1gunji">Permisos</p> <h1 class="svelte-1gunji">Gestión de Roles</h1> <p class="lede svelte-1gunji">Define las responsabilidades y alcance de tu equipo.</p> <div class="chips svelte-1gunji"><span class="chip success svelte-1gunji"> </span></div></div> <div class="hero-actions svelte-1gunji"><!></div></section> <!> <section class="panel svelte-1gunji"><div class="panel-head svelte-1gunji"><div><p class="label svelte-1gunji">Listado</p> <h2 class="svelte-1gunji">Roles</h2></div></div> <!></section> <!></div>');function xa(ve,de){Me(de,!1);const Q=()=>ne(Je,"$modulosConfig",X),f=()=>ne(T,"$roles",X),[X,ue]=We(),O=b(),S=b();let D=b(!1),N=b(null),p=b({open:!1,id:null,nombre:""}),l=b({nombre_rol:"",descripcion:""});const z="roles";let B=b(!1),I=b(!1),Y=b(!1);Ne(async()=>{if(!Ke(z)){x("No tienes acceso al módulo Roles","error"),He("/");return}await P()});async function P(){T.update(a=>({...a,loading:!0}));try{const a=await A.listar();T.update(i=>({...i,items:a.roles||[],loading:!1}))}catch(a){T.update(i=>({...i,error:a.message,loading:!1})),x(a.message,"error")}}async function pe(){o(N,null),o(l,{nombre_rol:"",descripcion:""}),o(D,!0),await oe(),ce()}async function me(a){o(N,a.id_rol),o(l,{nombre_rol:a.nombre_rol,descripcion:a.descripcion}),o(D,!0),await oe(),ce()}async function ge(){if(!e(l).nombre_rol){x("Completa el nombre del rol","warning");return}try{e(N)?(await A.actualizar(e(N),e(l).nombre_rol,e(l).descripcion),x("Rol actualizado","success")):(await A.crear(e(l).nombre_rol,e(l).descripcion),x("Rol creado","success")),o(D,!1),await P()}catch(a){x(a.message,"error")}}async function be(a){if(e(p).id)try{await A.eliminar(a),x("Rol eliminado","success"),o(p,{open:!1,id:null,nombre:""}),await P()}catch(i){x(i.message,"error")}}K(()=>Q(),()=>{o(O,Q())}),K(()=>(e(O),L),()=>{e(O),o(B,L(z,"crear")),o(I,L(z,"editar")),o(Y,L(z,"eliminar"))}),K(()=>f(),()=>{o(S,{total:f().items.length})}),qe(),Ve();var U=ia();Ie("1gunji",a=>{Fe(()=>{Ge.title="Gestión de Roles - TransConecta"})});var V=r(t(U),4),W=t(V),Z=r(t(W),6),ee=t(Z),fe=t(ee);s(ee),s(Z),s(W);var ae=r(W,2),_e=t(ae);{var je=a=>{var i=Qe();h("click",i,pe),c(a,i)};C(_e,a=>{e(B)&&a(je)})}s(ae),s(V);var se=r(V,2);{var he=a=>{var i=Xe(),_=t(i),m=t(_),R=r(t(m),2),v=t(R,!0);s(R),s(m);var d=r(m,2);s(_);var g=r(_,2),j=t(g),F=r(t(j),2);Pe(F),s(j);var n=r(j,2),E=r(t(n),2);Te(E),s(n);var $=r(n,2),J=r(t($),2);s($),s(g),s(i),G(()=>q(v,e(N)?"Editar rol":"Nuevo rol")),h("click",d,()=>o(D,!1)),le(F,()=>e(l).nombre_rol,w=>ie(l,e(l).nombre_rol=w)),le(E,()=>e(l).descripcion,w=>ie(l,e(l).descripcion=w)),h("click",J,()=>o(D,!1)),h("submit",g,Ue(ge)),c(a,i)};C(se,a=>{e(D)&&(e(B)||e(I))&&a(he)})}var H=r(se,2),ye=r(t(H),2);{var xe=a=>{var i=Ye();c(a,i)},Re=a=>{var i=Ae(),_=Le(i);{var m=v=>{var d=Ze();c(v,d)},R=v=>{var d=ta(),g=t(d),j=r(t(g));Se(j,5,()=>(f(),y(()=>f().items)),Be,(F,n)=>{var E=sa(),$=t(E),J=t($,!0);s($);var w=r($),Ce=t(w,!0);s(w);var te=r(w),re=t(te);{var De=k=>{var M=ea();h("click",M,()=>me(e(n))),c(k,M)};C(re,k=>{e(I)&&k(De)})}var Ee=r(re,2);{var $e=k=>{var M=aa();h("click",M,()=>o(p,{open:!0,id:e(n).id_rol,nombre:e(n).nombre_rol})),c(k,M)};C(Ee,k=>{e(Y)&&k($e)})}s(te),s(E),G(()=>{q(J,(e(n),y(()=>e(n).nombre_rol))),q(Ce,(e(n),y(()=>e(n).descripcion||"—")))}),c(F,E)}),s(j),s(g),s(d),c(v,d)};C(_,v=>{f(),y(()=>f().items.length===0)?v(m):v(R,!1)},!0)}c(a,i)};C(ye,a=>{f(),y(()=>f().loading)?a(xe):a(Re,!1)})}s(H);var we=r(H,2);{var ke=a=>{var i=ra(),_=t(i),m=r(t(_),4),R=r(t(m)),v=t(R,!0);s(R),Oe(),s(m);var d=r(m,2),g=t(d),j=r(g,2);s(d),s(_),s(i),G(()=>q(v,(e(p),y(()=>e(p).nombre)))),h("click",g,()=>o(p,{open:!1,id:null,nombre:""})),h("click",j,()=>be(e(p).id)),c(a,i)};C(we,a=>{e(p),y(()=>e(p).open)&&a(ke)})}s(U),G(()=>q(fe,`${e(S),y(()=>e(S).total)??""} roles`)),c(ve,U),ze(),ue()}export{xa as component};
