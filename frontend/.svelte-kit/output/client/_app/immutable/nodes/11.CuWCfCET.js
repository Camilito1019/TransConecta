import"../chunks/DsnmJJEf.js";import"../chunks/2J32lFCu.js";import{o as ws,a as p}from"../chunks/D5sqcERo.js";import{E as ms,at as Ds,au as es,av as Ls,aq as w,aw as G,a as V,ax as Ts,b as s,s as C,W as M,r as Is,ay as Us,az as r,ar as t,as as a,aC as Ns,u as l,f as ys}from"../chunks/DdWuALZu.js";import{i as As}from"../chunks/DNIL3y1X.js";import{e as cs}from"../chunks/qLEJnVdX.js";import{h as js}from"../chunks/CgsUcASs.js";import{s as ns}from"../chunks/DjPkcCDc.js";import{t as Bs,s as us}from"../chunks/D4-J_OgU.js";import{i as Gs}from"../chunks/-w5iKcy_.js";import{s as zs,a as xs}from"../chunks/B3jtdlFh.js";import{g as Ws}from"../chunks/C07Td5iz.js";import{i as qs,j as Fs,u as Js,h as Ks,k as Qs,e as Xs,f as Ys,g as Rs}from"../chunks/3qLZv7Rd.js";import{m as Zs,b as R,M as se}from"../chunks/y7-MpCW8.js";function $s(D,z,Q,X){var Y=D.__style;if(ms||Y!==z){var W=Bs(z);(!ms||W!==D.getAttribute("style"))&&(W==null?D.removeAttribute("style"):D.style.cssText=W),D.__style=z}return X}var ee=w('<div class="loading svelte-1uha8ag"><div class="spinner svelte-1uha8ag" aria-hidden="true"></div> <p>Cargando estadísticas...</p></div>'),ae=w('<p class="stat-sub svelte-1uha8ag"> </p> <div class="mini-bar svelte-1uha8ag" aria-hidden="true"><span class="svelte-1uha8ag"></span></div>',1),te=w('<p class="stat-sub muted svelte-1uha8ag"> </p>'),oe=w('<div><div class="stat-icon svelte-1uha8ag"><span class="ms-icon svelte-1uha8ag"> </span></div> <div class="stat-body svelte-1uha8ag"><p class="stat-label svelte-1uha8ag"> </p> <p class="stat-value svelte-1uha8ag"> </p> <!></div></div>'),ie=w('<div class="chart-card svelte-1uha8ag"><div class="donut svelte-1uha8ag" aria-hidden="true"><svg viewBox="0 0 42 42" class="donut-svg svelte-1uha8ag"><circle class="donut-bg svelte-1uha8ag" cx="21" cy="21" r="15.915" fill="transparent"></circle><circle class="donut-fg svelte-1uha8ag" cx="21" cy="21" r="15.915" fill="transparent" stroke-dashoffset="25"></circle></svg> <div class="donut-center svelte-1uha8ag"><span class="donut-value svelte-1uha8ag"> </span></div></div> <div class="chart-body"><p class="chart-title svelte-1uha8ag"> </p> <p class="chart-subtitle svelte-1uha8ag"> </p></div></div>'),re=w('<div><div class="feature-icon svelte-1uha8ag"><span class="ms-icon svelte-1uha8ag"> </span></div> <div><div class="feature-title-row svelte-1uha8ag"><h4 class="svelte-1uha8ag"> </h4> <span> </span></div> <p class="svelte-1uha8ag"> </p></div></div>'),le=w('<section class="section svelte-1uha8ag"><div class="section-head svelte-1uha8ag"><div><p class="label svelte-1uha8ag">Indicadores</p> <h2 class="svelte-1uha8ag">Métricas clave</h2> <p class="section-lede svelte-1uha8ag">Indicadores por módulo: totales y porcentajes operativos.</p></div></div> <div class="stats-grid svelte-1uha8ag"></div></section> <section class="section svelte-1uha8ag"><div class="section-head svelte-1uha8ag"><div><p class="label svelte-1uha8ag">Control</p> <h2 class="svelte-1uha8ag">Gráficos de porcentaje</h2> <p class="section-lede svelte-1uha8ag">Lectura rápida de salud operacional por módulo.</p></div></div> <div class="charts-grid svelte-1uha8ag"></div></section> <section class="section svelte-1uha8ag"><div class="section-head svelte-1uha8ag"><div><p class="label svelte-1uha8ag">Módulos</p> <h2 class="svelte-1uha8ag">Todos los módulos</h2> <p class="section-lede svelte-1uha8ag">Listado completo de capacidades de la aplicación (según permisos del rol).</p></div></div> <div class="features-grid svelte-1uha8ag"></div></section>',1),ce=w('<div class="page-shell svelte-1uha8ag"><div class="bg-shape shape-a svelte-1uha8ag" aria-hidden="true"></div> <div class="bg-shape shape-b svelte-1uha8ag" aria-hidden="true"></div> <section class="hero svelte-1uha8ag"><div class="hero-text svelte-1uha8ag"><p class="eyebrow svelte-1uha8ag">Panel operativo</p> <h1 class="svelte-1uha8ag">Bienvenido a TransConecta</h1> <p class="lede svelte-1uha8ag">Opera tu red de transporte con visibilidad, seguridad y control en tiempo real.</p> <div class="hero-meta svelte-1uha8ag"><span class="chip success svelte-1uha8ag"><span class="dot svelte-1uha8ag"></span> Sesión activa</span> <span class="chip soft svelte-1uha8ag">Datos actualizados</span></div></div> <div class="hero-card svelte-1uha8ag"><p class="label svelte-1uha8ag">Resumen rápido</p> <div class="hero-stats svelte-1uha8ag"><div class="mini-stat svelte-1uha8ag"><span class="svelte-1uha8ag">Usuarios</span> <strong class="svelte-1uha8ag"> </strong></div> <div class="mini-stat svelte-1uha8ag"><span class="svelte-1uha8ag">Vehículos</span> <strong class="svelte-1uha8ag"> </strong></div> <div class="mini-stat svelte-1uha8ag"><span class="svelte-1uha8ag">Asignaciones</span> <strong class="svelte-1uha8ag"> </strong></div></div> <p class="hint svelte-1uha8ag">Monitorea tu operación y accede rápido a cada módulo.</p></div></section> <!></div>');function Re(D,z){Ds(z,!1);const Q=()=>xs(qs,"$auth",Y),X=()=>xs(Zs,"$modulosConfig",Y),[Y,W]=zs(),L=M(),q=M(),U=["dashboard","usuarios","clientes","vehiculos","conductores","trayectos","asignaciones","roles","registroHoras"],Cs={dashboard:{label:"Dashboard",icon:"home",path:"/",description:"Visión general y métricas clave."},usuarios:{label:"Usuarios",icon:"group",path:"/usuarios",description:"Administra usuarios, roles y estados."},clientes:{label:"Clientes",icon:"apartment",path:"/clientes",description:"Gestiona clientes y su estado."},roles:{label:"Roles",icon:"admin_panel_settings",path:"/roles",description:"Define roles y permisos por rol."},modulos:{label:"Módulos",icon:"tune",path:"/modulos",description:"Configura visibilidad y acciones por rol."},vehiculos:{label:"Vehículos",icon:"local_shipping",path:"/vehiculos",description:"Control de flota, documentos y estados."},conductores:{label:"Conductores",icon:"badge",path:"/conductores",description:"Gestión de conductores, alertas y estados."},trayectos:{label:"Trayectos",icon:"map",path:"/trayectos",description:"Rutas, planificación y operación."},asignaciones:{label:"Asignaciones",icon:"route",path:"/asignaciones",description:"Asigna trayectos a vehículos y conductores."},registroHoras:{label:"Registro de Horas",icon:"schedule",path:"/operaciones/horas",description:"Registra horas de conducción por conductor."}};let h={usuarios:[],clientes:[],roles:[],vehiculos:[],conductores:[],trayectos:[],asignaciones:[]},i=M({usuarios:0,clientes:0,roles:0,vehiculos:0,conductores:0,trayectos:0,asignaciones:0,modulos:U.length}),g=M({usuariosActivos:0,clientesActivos:0,vehiculosOperativos:0,vehiculosEnRuta:0,conductoresNoInactivos:0,conductoresEnRuta:0,trayectosAsignados:0,modulosHabilitados:0}),F=M(0),as=M(0),ts=M([]),vs=M([]),k=M(!0);const N=c=>String(c??"").toLowerCase(),O=(c,o)=>{const d=Number(c)||0,y=Number(o)||0;return y<=0?0:Math.max(0,Math.min(100,Math.round(d/y*100)))},j=(c,o)=>{if(!Array.isArray(c)||typeof o!="function")return 0;let d=0;for(const y of c)o(y)&&(d+=1);return d};ws(async()=>{if(!R("dashboard","ver")&&R("registroHoras","ver")){Ws("/operaciones/horas",{replaceState:!0});return}if(!Fs.getToken()){C(k,!1);return}try{const o=R("conductores","ver")||R("registroHoras","ver"),d=[R("usuarios","ver")?Js.listar():Promise.resolve(null),R("clientes","ver")?Ks.listar():Promise.resolve(null),R("roles","ver")?Qs.listar():Promise.resolve(null),R("vehiculos","ver")?Xs.listar():Promise.resolve(null),o?Ys.listar():Promise.resolve(null),R("trayectos","ver")?Rs.listar():Promise.resolve(null),R("asignaciones","ver")?Rs.listarAsignaciones():Promise.resolve(null)],[y,v,_,b,Z,f,e]=await Promise.all(d);h={usuarios:y?.usuarios||[],clientes:v?.clientes||[],roles:_?.roles||[],vehiculos:b?.vehiculos||[],conductores:Z?.conductores||[],trayectos:f?.trayectos||[],asignaciones:e?.asignaciones||[]},C(i,{usuarios:h.usuarios.length,clientes:h.clientes.length,roles:h.roles.length,vehiculos:h.vehiculos.length,conductores:h.conductores.length,trayectos:h.trayectos.length,asignaciones:h.asignaciones.length,modulos:U.length});const u=j(h.usuarios,n=>N(n?.estado)==="activo"),A=j(h.clientes,n=>N(n?.estado)==="activo"),m=j(h.vehiculos,n=>N(n?.estado_operativo)==="operativo"),S=j(h.vehiculos,n=>N(n?.estado_operativo)==="en_ruta"),H=j(h.conductores,n=>N(n?.estado)!=="inactivo"),$=j(h.conductores,n=>N(n?.estado)==="en_ruta"),x=O(s(i).asignaciones,s(i).trayectos);C(g,{usuariosActivos:O(u,s(i).usuarios),clientesActivos:O(A,s(i).clientes),vehiculosOperativos:O(m,s(i).vehiculos),vehiculosEnRuta:O(S,s(i).vehiculos),conductoresNoInactivos:O(H,s(i).conductores),conductoresEnRuta:O($,s(i).conductores),trayectosAsignados:x,modulosHabilitados:s(F)})}catch(o){console.error("Error cargando estadísticas:",o)}C(k,!1)}),es(()=>Q(),()=>{C(L,Q()?.usuario?.nombre_rol?String(Q().usuario.nombre_rol).toUpperCase():null)}),es(()=>(s(L),X()),()=>{C(q,s(L)?X()?.[s(L)]:null)}),es(()=>s(q),()=>{const c=s(q)?U.filter(o=>s(q)?.[o]?.sidebar===!0&&s(q)?.[o]?.acciones?.ver===!0):[];C(as,c.length),C(F,O(c.length,U.length))}),es(()=>(s(i),s(g),s(F),s(L),s(as)),()=>{const c=se.filter(o=>o!=="dashboard").map(o=>{const d=Cs[o]||{label:o,icon:"apps",path:"/"},y=!R(o,"ver");let v="—",_=null,b="";return o==="usuarios"?(v=s(i).usuarios,_=s(g).usuariosActivos,b="activos"):o==="clientes"?(v=s(i).clientes,_=s(g).clientesActivos,b="activos"):o==="roles"?v=s(i).roles:o==="modulos"?(v=s(i).modulos,_=s(F),b="habilitados"):o==="vehiculos"?(v=s(i).vehiculos,_=s(g).vehiculosOperativos,b="operativos"):o==="conductores"?(v=s(i).conductores,_=s(g).conductoresNoInactivos,b="disponibles"):o==="trayectos"?(v=s(i).trayectos,_=s(g).trayectosAsignados,b="asignados"):o==="asignaciones"?(v=s(i).asignaciones,_=s(g).vehiculosEnRuta,b="flota en ruta"):o==="registroHoras"&&(v=s(i).conductores,_=s(g).conductoresEnRuta,b="conductores en ruta"),{modulo:o,label:d.label,icon:d.icon,path:d.path,description:d.description,value:v,percentValue:_,percentLabel:b,disabled:y}});C(ts,c),C(vs,[{key:"usuarios",title:"Usuarios activos",subtitle:`${s(i).usuarios} usuarios`,percent:s(g).usuariosActivos,ring:"var(--tc-success-text)"},{key:"clientes",title:"Clientes activos",subtitle:`${s(i).clientes} clientes`,percent:s(g).clientesActivos,ring:"var(--tc-success-text)"},{key:"vehiculos",title:"Vehículos operativos",subtitle:`${s(i).vehiculos} vehículos`,percent:s(g).vehiculosOperativos,ring:"var(--tc-accent)"},{key:"enRuta",title:"Flota en ruta",subtitle:`${s(i).vehiculos} vehículos`,percent:s(g).vehiculosEnRuta,ring:"var(--tc-accent-2)"},{key:"trayectos",title:"Trayectos asignados",subtitle:`${s(i).asignaciones} asignaciones`,percent:s(g).trayectosAsignados,ring:"var(--tc-accent-2)"},{key:"modulos",title:"Módulos habilitados",subtitle:s(L)?`${s(as)} de ${U.length} (rol ${s(L)})`:`${U.length} módulos`,percent:s(F),ring:"var(--tc-warning-text)"}])}),Ls(),Gs();var os=ce();js("1uha8ag",c=>{Is(()=>{Us.title="Dashboard - TransConecta"})});var is=r(t(os),4),ds=r(t(is),2),ps=r(t(ds),2),rs=t(ps),hs=r(t(rs),2),ks=t(hs,!0);a(hs),a(rs);var ls=r(rs,2),gs=r(t(ls),2),Ss=t(gs,!0);a(gs),a(ls);var _s=r(ls,2),bs=r(t(_s),2),Es=t(bs,!0);a(bs),a(_s),a(ps),Ns(2),a(ds),a(is);var Ms=r(is,2);{var Os=c=>{var o=ee();V(c,o)},Hs=c=>{var o=le(),d=ys(o),y=r(t(d),2);cs(y,5,()=>s(ts),f=>f.modulo,(f,e)=>{var u=oe();let A;var m=t(u),S=t(m),H=t(S,!0);a(S),a(m);var $=r(m,2),x=t($),n=t(x,!0);a(x);var E=r(x,2),T=t(E,!0);a(E);var I=r(E,2);{var J=P=>{var B=ae(),K=ys(B),Ps=t(K);a(K);var fs=r(K,2),Vs=t(fs);a(fs),G(()=>{p(Ps,`${s(e),l(()=>s(e).percentValue)??""}% ${s(e),l(()=>s(e).percentLabel)??""}`),$s(Vs,(s(e),l(()=>`width: ${s(e).percentValue}%`)))}),V(P,B)},ss=P=>{var B=te(),K=t(B,!0);a(B),G(()=>p(K,(s(e),l(()=>s(e).disabled?"Sin acceso":"—")))),V(P,B)};As(I,P=>{s(e),l(()=>s(e).percentValue!==null&&s(e).percentValue!==void 0)?P(J):P(ss,!1)})}a($),a(u),G(()=>{A=us(u,1,"stat-card svelte-1uha8ag",null,A,{disabled:s(e).disabled}),ns(u,"aria-label",(s(e),l(()=>s(e).label))),p(H,(s(e),l(()=>s(e).icon))),p(n,(s(e),l(()=>s(e).label))),p(T,(s(e),l(()=>s(e).value)))}),V(f,u)}),a(y),a(d);var v=r(d,2),_=r(t(v),2);cs(_,5,()=>s(vs),f=>f.key,(f,e)=>{var u=ie(),A=t(u),m=t(A),S=r(t(m));a(m);var H=r(m,2),$=t(H),x=t($);a($),a(H),a(A);var n=r(A,2),E=t(n),T=t(E,!0);a(E);var I=r(E,2),J=t(I,!0);a(I),a(n),a(u),G(()=>{$s(u,(s(e),l(()=>`--ring: ${s(e).ring};`))),ns(S,"stroke-dasharray",(s(e),l(()=>`${s(e).percent} ${100-s(e).percent}`))),p(x,`${s(e),l(()=>s(e).percent)??""}%`),p(T,(s(e),l(()=>s(e).title))),p(J,(s(e),l(()=>s(e).subtitle)))}),V(f,u)}),a(_),a(v);var b=r(v,2),Z=r(t(b),2);cs(Z,5,()=>s(ts),f=>f.modulo,(f,e)=>{var u=re();let A;var m=t(u),S=t(m),H=t(S,!0);a(S),a(m);var $=r(m,2),x=t($),n=t(x),E=t(n,!0);a(n);var T=r(n,2);let I;var J=t(T,!0);a(T),a(x);var ss=r(x,2),P=t(ss,!0);a(ss),a($),a(u),G(()=>{A=us(u,1,"feature-card svelte-1uha8ag",null,A,{disabled:s(e).disabled}),ns(u,"aria-label",(s(e),l(()=>s(e).label))),p(H,(s(e),l(()=>s(e).icon))),p(E,(s(e),l(()=>s(e).label))),I=us(T,1,"feature-chip svelte-1uha8ag",null,I,{locked:s(e).disabled}),p(J,(s(e),l(()=>s(e).disabled?"Sin acceso":"Disponible"))),p(P,(s(e),l(()=>s(e).description)))}),V(f,u)}),a(Z),a(b),V(c,o)};As(Ms,c=>{s(k)?c(Os):c(Hs,!1)})}a(os),G(()=>{p(ks,(s(k),s(i),l(()=>s(k)?"—":s(i).usuarios))),p(Ss,(s(k),s(i),l(()=>s(k)?"—":s(i).vehiculos))),p(Es,(s(k),s(i),l(()=>s(k)?"—":s(i).asignaciones)))}),V(D,os),Ts(),W()}export{Re as component};
