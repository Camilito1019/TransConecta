import"../chunks/DsnmJJEf.js";import"../chunks/2J32lFCu.js";import{o as Ua,e as ha,a as y}from"../chunks/D5sqcERo.js";import{at as Va,W as x,au as ma,av as Wa,aq as b,aw as D,b as a,a as f,ax as Ea,r as Ga,az as o,u as n,ar as r,s as v,aB as R,ay as Ja,as as t,aA as Ka,aD as Pa,c as Y,f as Z}from"../chunks/DdWuALZu.js";import{i as N}from"../chunks/DNIL3y1X.js";import{e as ga,i as ba}from"../chunks/qLEJnVdX.js";import{h as Qa}from"../chunks/CgsUcASs.js";import{a as Xa,r as S}from"../chunks/DjPkcCDc.js";import{b as M}from"../chunks/CnWbZhhT.js";import{b as Ya}from"../chunks/pQeqK__H.js";import{i as Za}from"../chunks/-w5iKcy_.js";import{s as ae,a as ee}from"../chunks/B3jtdlFh.js";import{g as se}from"../chunks/C07Td5iz.js";import{b as g,f as aa}from"../chunks/3qLZv7Rd.js";import{b as ya,m as te,a as re}from"../chunks/y7-MpCW8.js";var oe=b('<span class="chip muted svelte-f3a5ef"> </span>'),ie=b("<option>Cargando...</option>"),le=b("<option>No hay conductores</option>"),ne=b("<option> </option>"),ce=b('<div class="loading svelte-f3a5ef"><div class="spinner svelte-f3a5ef"></div> <p>Cargando registros...</p></div>'),fe=b('<div class="empty svelte-f3a5ef"><p>No hay registros de horas para este conductor.</p></div>'),ve=b('<tr class="svelte-f3a5ef"><td class="svelte-f3a5ef"> </td><td class="svelte-f3a5ef"> </td><td class="svelte-f3a5ef"> </td><td class="svelte-f3a5ef"> </td><td class="svelte-f3a5ef"> </td></tr>'),de=b('<div class="table-wrap svelte-f3a5ef"><table class="svelte-f3a5ef"><thead class="svelte-f3a5ef"><tr class="svelte-f3a5ef"><th class="svelte-f3a5ef">Fecha</th><th class="svelte-f3a5ef">Inicio</th><th class="svelte-f3a5ef">Fin</th><th class="svelte-f3a5ef">Horas</th><th class="svelte-f3a5ef">Observaciones</th></tr></thead><tbody class="svelte-f3a5ef"></tbody></table></div>'),pe=b('<div class="page-shell svelte-f3a5ef"><div class="bg-shape shape-a svelte-f3a5ef" aria-hidden="true"></div> <div class="bg-shape shape-b svelte-f3a5ef" aria-hidden="true"></div> <section class="hero svelte-f3a5ef"><div class="hero-text svelte-f3a5ef"><p class="eyebrow svelte-f3a5ef">Operaciones</p> <h1 class="svelte-f3a5ef">Registro de Horas</h1> <p class="lede svelte-f3a5ef">Carga rápida de horas de conducción por conductor y fecha.</p> <div class="chips svelte-f3a5ef"><span class="chip success svelte-f3a5ef"> </span> <!></div></div></section> <section class="panel svelte-f3a5ef"><div class="panel-head svelte-f3a5ef"><div><p class="label svelte-f3a5ef">Formulario</p> <h2 class="svelte-f3a5ef">Registrar horas</h2></div></div> <div class="form-grid svelte-f3a5ef"><label class="field svelte-f3a5ef"><span>Conductor</span> <select class="svelte-f3a5ef"><!></select></label> <label class="field svelte-f3a5ef"><span>Fecha</span> <input type="date" class="svelte-f3a5ef"/></label> <label class="field svelte-f3a5ef"><span>Hora inicio</span> <input type="time" class="svelte-f3a5ef"/></label> <label class="field svelte-f3a5ef"><span>Hora fin</span> <input type="time" class="svelte-f3a5ef"/></label> <label class="field svelte-f3a5ef"><span>Horas calculadas</span> <input type="text" readonly="" class="svelte-f3a5ef"/></label> <label class="field full svelte-f3a5ef"><span>Observaciones</span> <textarea rows="3" placeholder="Notas u observaciones" class="svelte-f3a5ef"></textarea></label> <div class="form-actions svelte-f3a5ef"><button class="primary svelte-f3a5ef">Registrar</button></div></div></section> <section class="panel svelte-f3a5ef"><div class="panel-head svelte-f3a5ef"><div><p class="label svelte-f3a5ef">Histórico</p> <h2 class="svelte-f3a5ef">Últimos registros</h2></div></div> <!></section></div>');function Fe(xa,wa){Va(wa,!1);const ea=()=>ee(te,"$modulosConfig",Ca),[Ca,Ha]=ae(),T=x(),sa="registroHoras";let I=x(!1),h=x([]),C=x(!0),p=x(null),k=x(!1),m=x(""),s=x({fecha:new Date().toISOString().slice(0,10),hora_inicio:"",hora_fin:"",observaciones:""});Ua(async()=>{if(!re(sa)){g("No tienes acceso al módulo Registro de Horas","error"),se("/");return}await $a()});async function $a(){v(C,!0);try{const e=await aa.listar();v(h,e.conductores||[]),a(h).length>0&&(v(m,a(h)[0].id_conductor),await j(a(m)))}catch(e){g(e.message,"error")}finally{v(C,!1)}}async function j(e){if(e){v(k,!0);try{v(p,await aa.obtenerDetalles(e))}catch(i){g(i.message,"error")}finally{v(k,!1)}}}function ta(){if(!a(s).fecha||!a(s).hora_inicio||!a(s).hora_fin)return 0;const e=new Date(`${a(s).fecha}T${a(s).hora_inicio}`),d=(new Date(`${a(s).fecha}T${a(s).hora_fin}`).getTime()-e.getTime())/(1e3*60*60);return Number.isFinite(d)?Math.max(d,0):0}function Da(e){const d=e.target?.value||"";v(m,d),j(d)}async function Na(){if(!a(I)){g("No tienes permisos para registrar horas","error");return}if(!a(m)){g("Selecciona un conductor","warning");return}if(!a(s).fecha||!a(s).hora_inicio||!a(s).hora_fin){g("Completa fecha y horas","warning");return}const e=ta();if(e<=0){g("La hora fin debe ser mayor a la hora inicio","warning");return}try{await aa.registrarHoras(a(m),{fecha:a(s).fecha,hora_inicio:a(s).hora_inicio,hora_fin:a(s).hora_fin,horas_manejadas:e,observaciones:a(s).observaciones||null}),g("Horas registradas","success"),v(s,{fecha:new Date().toISOString().slice(0,10),hora_inicio:"",hora_fin:"",observaciones:""}),await j(a(m))}catch(i){g(i.message,"error")}}ma(()=>ea(),()=>{v(T,ea())}),ma(()=>(a(T),ya),()=>{a(T),v(I,ya(sa,"crear"))}),Wa(),Za();var A=pe();Qa("f3a5ef",e=>{Ga(()=>{Ja.title="Registro de Horas - TransConecta"})});var L=o(r(A),4),ra=r(L),oa=o(r(ra),6),q=r(oa),Oa=r(q);t(q);var Fa=o(q,2);{var Ra=e=>{var i=oe(),d=r(i);t(i),D(()=>y(d,`Último registro: ${a(p),n(()=>a(p).horas_conduccion?.[0]?.fecha||"—")??""}`)),f(e,i)};N(Fa,e=>{a(p)&&e(Ra)})}t(oa),t(ra),t(L);var z=o(L,2),ia=o(r(z),2),B=r(ia),H=o(r(B),2);D(()=>{a(m),Ka(()=>{a(C),a(h)})});var Sa=r(H);{var Ma=e=>{var i=ie();f(e,i)},Ta=e=>{var i=Y(),d=Z(i);{var J=c=>{var _=le();f(c,_)},K=c=>{var _=Y(),O=Z(_);ga(O,1,()=>a(h),ba,(F,u)=>{var l=ne(),$=r(l);t(l);var w={};D(()=>{y($,`${a(u),n(()=>a(u).nombre)??""} - ${a(u),n(()=>a(u).cedula)??""}`),w!==(w=(a(u),n(()=>a(u).id_conductor)))&&(l.value=(l.__value=(a(u),n(()=>a(u).id_conductor)))??"")}),f(F,l)}),f(c,_)};N(d,c=>{a(h),n(()=>a(h).length===0)?c(J):c(K,!1)},!0)}f(e,i)};N(Sa,e=>{a(C)?e(Ma):e(Ta,!1)})}t(H),t(B);var U=o(B,2),la=o(r(U),2);S(la),t(U);var V=o(U,2),na=o(r(V),2);S(na),t(V);var W=o(V,2),ca=o(r(W),2);S(ca),t(W);var E=o(W,2),fa=o(r(E),2);S(fa),t(E);var G=o(E,2),va=o(r(G),2);Pa(va),t(G);var da=o(G,2),pa=r(da);t(da),t(ia),t(z);var _a=o(z,2),Ia=o(r(_a),2);{var ka=e=>{var i=ce();f(e,i)},ja=e=>{var i=Y(),d=Z(i);{var J=c=>{var _=fe();f(c,_)},K=c=>{var _=de(),O=r(_),F=o(r(O));ga(F,5,()=>(a(p),n(()=>a(p).horas_conduccion.slice(0,10))),ba,(u,l)=>{var $=ve(),w=r($),Aa=r(w,!0);t(w);var P=o(w),La=r(P,!0);t(P);var Q=o(P),qa=r(Q,!0);t(Q);var X=o(Q),za=r(X,!0);t(X);var ua=o(X),Ba=r(ua,!0);t(ua),t($),D(()=>{y(Aa,(a(l),n(()=>a(l).fecha))),y(La,(a(l),n(()=>a(l).hora_inicio))),y(qa,(a(l),n(()=>a(l).hora_fin))),y(za,(a(l),n(()=>a(l).horas_manejadas))),y(Ba,(a(l),n(()=>a(l).observaciones||"—")))}),f(u,$)}),t(F),t(O),t(_),f(c,_)};N(d,c=>{a(p),n(()=>!a(p)||!a(p).horas_conduccion||a(p).horas_conduccion.length===0)?c(J):c(K,!1)},!0)}f(e,i)};N(Ia,e=>{a(k)?e(ka):e(ja,!1)})}t(_a),t(A),D(e=>{y(Oa,`${a(h),n(()=>a(h).length)??""} conductores`),H.disabled=a(C),Xa(fa,e),pa.disabled=!a(I)},[()=>n(()=>`${ta().toFixed(2)} h`)]),Ya(H,()=>a(m),e=>v(m,e)),ha("change",H,Da),M(la,()=>a(s).fecha,e=>R(s,a(s).fecha=e)),M(na,()=>a(s).hora_inicio,e=>R(s,a(s).hora_inicio=e)),M(ca,()=>a(s).hora_fin,e=>R(s,a(s).hora_fin=e)),M(va,()=>a(s).observaciones,e=>R(s,a(s).observaciones=e)),ha("click",pa,Na),f(xa,A),Ea(),Ha()}export{Fe as component};
