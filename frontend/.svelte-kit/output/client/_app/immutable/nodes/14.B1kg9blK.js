import"../chunks/DsnmJJEf.js";import"../chunks/2J32lFCu.js";import{o as Xe,a as w,e as h}from"../chunks/D5sqcERo.js";import{at as Ye,au as ee,av as Ze,aq as p,aw as W,a as v,ax as ea,b as e,W as g,r as aa,s as n,ay as ta,az as l,ar as s,as as t,u as d,aA as sa,aB as ae,c as me,f as be,aC as la,aa as _e,ao as he}from"../chunks/DdWuALZu.js";import{i as k}from"../chunks/DNIL3y1X.js";import{e as oa,i as ra}from"../chunks/qLEJnVdX.js";import{h as ia}from"../chunks/CgsUcASs.js";import{r as ge}from"../chunks/DjPkcCDc.js";import{s as na}from"../chunks/D4-J_OgU.js";import{b as ye}from"../chunks/CnWbZhhT.js";import{b as ca}from"../chunks/pQeqK__H.js";import{p as va}from"../chunks/CdEA5IGF.js";import{i as da}from"../chunks/-w5iKcy_.js";import{s as ua,a as Ce}from"../chunks/B3jtdlFh.js";import{g as fa}from"../chunks/C07Td5iz.js";import{d as H,b as y,h as L}from"../chunks/3qLZv7Rd.js";import{e as xe,m as pa,a as ma,c as ba,d as _a,p as ha}from"../chunks/y7-MpCW8.js";import{e as we,a as ke}from"../chunks/BCA_XIn1.js";import{s as Ee}from"../chunks/V8TKOVD4.js";var ga=p('<button class="primary svelte-1uf6cn0">+ Nuevo cliente</button>'),ya=p('<section class="panel svelte-1uf6cn0"><div class="panel-head svelte-1uf6cn0"><div><p class="label svelte-1uf6cn0">Formulario</p> <h2 class="svelte-1uf6cn0"> </h2></div> <button class="ghost svelte-1uf6cn0">Cerrar</button></div> <form class="form-grid svelte-1uf6cn0"><label class="field svelte-1uf6cn0"><span>Nombre</span> <input type="text" placeholder="Cliente S.A." required class="svelte-1uf6cn0"/></label> <label class="field svelte-1uf6cn0"><span>Teléfono</span> <input type="text" placeholder="3001234567" class="svelte-1uf6cn0"/></label> <label class="field svelte-1uf6cn0"><span>Estado</span> <select class="svelte-1uf6cn0"><option>Activo</option><option>Inactivo</option></select></label> <div class="form-actions svelte-1uf6cn0"><button type="submit" class="primary svelte-1uf6cn0">Guardar</button> <button type="button" class="ghost svelte-1uf6cn0">Cancelar</button></div></form></section>'),Ca=p('<div class="loading svelte-1uf6cn0"><div class="spinner svelte-1uf6cn0"></div> <p>Cargando clientes...</p></div>'),xa=p('<div class="empty svelte-1uf6cn0"><p>No hay clientes registrados.</p></div>'),wa=p('<button class="ghost svelte-1uf6cn0">Editar</button>'),ka=p('<button class="success svelte-1uf6cn0">Activar</button>'),Ea=p('<button class="danger svelte-1uf6cn0">Desactivar</button>'),Aa=p('<button class="outline svelte-1uf6cn0">Eliminar</button>'),$a=p('<tr class="svelte-1uf6cn0"><td class="svelte-1uf6cn0"> </td><td class="svelte-1uf6cn0"> </td><td class="svelte-1uf6cn0"><span> </span></td><td class="actions svelte-1uf6cn0"><!> <!> <!></td></tr>'),Na=p('<div class="table-wrap svelte-1uf6cn0"><table class="svelte-1uf6cn0"><thead class="svelte-1uf6cn0"><tr class="svelte-1uf6cn0"><th class="svelte-1uf6cn0">Nombre</th><th class="svelte-1uf6cn0">Teléfono</th><th class="svelte-1uf6cn0">Estado</th><th class="svelte-1uf6cn0"></th></tr></thead><tbody class="svelte-1uf6cn0"></tbody></table></div>'),Da=p('<div class="modal-backdrop svelte-1uf6cn0"><div class="modal svelte-1uf6cn0"><p class="label svelte-1uf6cn0">Confirmar</p> <h3 class="svelte-1uf6cn0"> </h3> <p class="lede svelte-1uf6cn0"> <strong> </strong>.</p> <div class="modal-actions svelte-1uf6cn0"><button class="ghost svelte-1uf6cn0">Cancelar</button> <button class="danger svelte-1uf6cn0">Confirmar</button></div></div></div>'),Sa=p('<div class="page-shell svelte-1uf6cn0"><div class="bg-shape shape-a svelte-1uf6cn0" aria-hidden="true"></div> <div class="bg-shape shape-b svelte-1uf6cn0" aria-hidden="true"></div> <section class="hero svelte-1uf6cn0"><div class="hero-text svelte-1uf6cn0"><p class="eyebrow svelte-1uf6cn0">Gestión</p> <h1 class="svelte-1uf6cn0">Clientes</h1> <p class="lede svelte-1uf6cn0">Administra los clientes asociados a los trayectos.</p> <div class="chips svelte-1uf6cn0"><span class="chip success svelte-1uf6cn0"> </span> <span class="chip muted svelte-1uf6cn0"> </span></div></div> <div class="hero-actions svelte-1uf6cn0"><!></div></section> <!> <section class="panel svelte-1uf6cn0"><div class="panel-head svelte-1uf6cn0"><div><p class="label svelte-1uf6cn0">Listado</p> <h2 class="svelte-1uf6cn0">Clientes</h2></div></div> <!></section> <!></div>');function Ra(Ae,$e){Ye($e,!1);const te=()=>Ce(pa,"$modulosConfig",se),m=()=>Ce(H,"$clientes",se),[se,Ne]=ua(),J=g(),q=g();let F=g(!1),I=g(null),r=g({open:!1,type:null,id:null,label:""}),c=g({nombre:"",telefono:"",estado:"activo"});const O="clientes";let le=g(!1),oe=g(!1),re=g(!1),ie=g(!1);Xe(async()=>{if(!ma(O)){y("No tienes acceso al módulo Clientes","error"),fa("/");return}await K()});async function K(){H.update(a=>({...a,loading:!0}));try{const a=await L.listar();H.update(o=>({...o,items:a.clientes||[],loading:!1}))}catch(a){H.update(o=>({...o,error:a.message,loading:!1})),y(a.message,"error")}}function De(){n(I,null),n(c,{nombre:"",telefono:"",estado:"activo"})}async function Se(){De(),n(F,!0),await _e(),Ee()}async function Te(a){n(I,a.id_cliente),n(c,{nombre:a.nombre||"",telefono:a.telefono||"",estado:a.estado||"activo"}),n(F,!0),await _e(),Ee()}async function Fe(){if(!e(c).nombre){y("El nombre es obligatorio","warning");return}const a={nombre:e(c).nombre,telefono:e(c).telefono||null,estado:e(c).estado||"activo"};try{e(I)?(await L.actualizar(e(I),a),y("Cliente actualizado","success")):(await L.crear(a),y("Cliente creado","success")),n(F,!1),await K()}catch(o){y(o.message,"error")}}function P(a,o){n(r,{open:!0,type:a,id:o.id_cliente,label:o.nombre})}async function Me(){if(!(!e(r).id||!e(r).type))try{e(r).type==="eliminar"?(await L.eliminar(e(r).id),y("Cliente eliminado","success")):e(r).type==="desactivar"?(await L.desactivar(e(r).id),y("Cliente desactivado","success")):e(r).type==="activar"&&(await L.activar(e(r).id),y("Cliente activado","success")),n(r,{open:!1,type:null,id:null,label:""}),await K()}catch(a){y(a.message,"error")}}ee(()=>te(),()=>{n(J,te())}),ee(()=>(e(J),xe),()=>{e(J),n(le,ba(O)),n(oe,_a(O)),n(re,ha(O)),n(ie,xe(O))}),ee(()=>m(),()=>{n(q,{total:m().items.length,activos:m().items.filter(a=>a.estado==="activo").length,inactivos:m().items.filter(a=>a.estado==="inactivo").length})}),Ze(),da();var Q=Sa();ia("1uf6cn0",a=>{aa(()=>{ta.title="Gestión de Clientes - TransConecta"})});var R=l(s(Q),4),X=s(R),ne=l(s(X),6),Y=s(ne),ze=s(Y);t(Y);var ce=l(Y,2),Ge=s(ce);t(ce),t(ne),t(X);var ve=l(X,2),Le=s(ve);{var qe=a=>{var o=ga();h("click",o,Se),v(a,o)};k(Le,a=>{e(le)&&a(qe)})}t(ve),t(R);var de=l(R,2);{var Ie=a=>{var o=ya(),E=s(o),C=s(E),M=l(s(C),2),f=s(M,!0);t(M),t(C);var b=l(C,2);t(E);var x=l(E,2),A=s(x),N=l(s(A),2);ge(N),t(A);var i=l(A,2),$=l(s(i),2);ge($),t(i);var D=l(i,2),B=l(s(D),2);W(()=>{e(c),sa(()=>{})});var S=s(B);S.value=S.__value="activo";var j=l(S);j.value=j.__value="inactivo",t(B),t(D);var z=l(D,2),U=l(s(z),2);t(z),t(x),t(o),W(()=>w(f,e(I)?"Editar cliente":"Nuevo cliente")),h("click",b,()=>n(F,!1)),ye(N,()=>e(c).nombre,T=>ae(c,e(c).nombre=T)),ye($,()=>e(c).telefono,T=>ae(c,e(c).telefono=T)),ca(B,()=>e(c).estado,T=>ae(c,e(c).estado=T)),h("click",U,()=>n(F,!1)),h("submit",x,va(Fe)),v(a,o)};k(de,a=>{e(F)&&a(Ie)})}var Z=l(de,2),Oe=l(s(Z),2);{var Be=a=>{var o=Ca();v(a,o)},Ue=a=>{var o=me(),E=be(o);{var C=f=>{var b=xa();v(f,b)},M=f=>{var b=Na(),x=s(b),A=l(s(x));oa(A,5,()=>(m(),d(()=>m().items)),ra,(N,i)=>{var $=$a(),D=s($),B=s(D,!0);t(D);var S=l(D),j=s(S,!0);t(S);var z=l(S),U=s(z),T=s(U,!0);t(U),t(z);var ue=l(z),fe=s(ue);{var je=u=>{var _=wa();h("click",_,()=>Te(e(i))),v(u,_)};k(fe,u=>{e(oe)&&u(je)})}var pe=l(fe,2);{var He=u=>{var _=me(),Pe=be(_);{var Qe=G=>{var V=ka();h("click",V,()=>P("activar",e(i))),v(G,V)},Re=G=>{var V=Ea();h("click",V,()=>P("desactivar",e(i))),v(G,V)};k(Pe,G=>{e(i),d(()=>e(i).estado==="inactivo")?G(Qe):G(Re,!1)})}v(u,_)};k(pe,u=>{e(ie)&&u(He)})}var Je=l(pe,2);{var Ke=u=>{var _=Aa();h("click",_,()=>P("eliminar",e(i))),v(u,_)};k(Je,u=>{e(re)&&u(Ke)})}t(ue),t($),W((u,_)=>{w(B,(e(i),d(()=>e(i).nombre))),w(j,(e(i),d(()=>e(i).telefono||"—"))),na(U,1,u,"svelte-1uf6cn0"),w(T,_)},[()=>(he(we),e(i),d(()=>`status-pill status-${we(e(i).estado)}`)),()=>(he(ke),e(i),d(()=>ke(e(i).estado)))]),v(N,$)}),t(A),t(x),t(b),v(f,b)};k(E,f=>{m(),d(()=>m().items.length===0)?f(C):f(M,!1)},!0)}v(a,o)};k(Oe,a=>{m(),d(()=>m().loading)?a(Be):a(Ue,!1)})}t(Z);var Ve=l(Z,2);{var We=a=>{var o=Da(),E=s(o),C=l(s(E),2),M=s(C,!0);t(C);var f=l(C,2),b=s(f),x=l(b),A=s(x,!0);t(x),la(),t(f);var N=l(f,2),i=s(N),$=l(i,2);t(N),t(E),t(o),W(()=>{w(M,(e(r),d(()=>e(r).type==="eliminar"?"¿Eliminar cliente?":e(r).type==="desactivar"?"¿Desactivar cliente?":"¿Activar cliente?"))),w(b,`${e(r),d(()=>e(r).type==="eliminar"?"Se eliminará ":e(r).type==="desactivar"?"Se marcará inactivo ":"Se marcará activo ")??""} `),w(A,(e(r),d(()=>e(r).label)))}),h("click",i,()=>n(r,{open:!1,type:null,id:null,label:""})),h("click",$,Me),v(a,o)};k(Ve,a=>{e(r),d(()=>e(r).open)&&a(We)})}t(Q),W(()=>{w(ze,`${e(q),d(()=>e(q).activos)??""} activos`),w(Ge,`${e(q),d(()=>e(q).inactivos)??""} inactivos`)}),v(Ae,Q),ea(),Ne()}export{Ra as component};
