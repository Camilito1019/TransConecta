import"../chunks/DsnmJJEf.js";import"../chunks/2J32lFCu.js";import{w as Oe,g as Pe,c as He,o as Me,e as I,a as pe}from"../chunks/D5sqcERo.js";import{v as Le,at as ke,s as a,W as d,aq as v,bg as Ve,ar as m,az as p,as as u,a as o,ax as je,b as e,aw as Ce,au as x,av as Re,c as ue,f as oe,ao as ze,u as Ge}from"../chunks/DdWuALZu.js";import{i as h}from"../chunks/DNIL3y1X.js";import{s as be}from"../chunks/Dcw1k4_p.js";import{i as Ae}from"../chunks/-w5iKcy_.js";import{p as Ue}from"../chunks/_X9-3qsY.js";import{a as re,s as ge}from"../chunks/B3jtdlFh.js";import{s as ye}from"../chunks/DjPkcCDc.js";import{s as xe}from"../chunks/CdEA5IGF.js";import{i as ie,o as We,p as Be,j as me,s as Ke,b as $e}from"../chunks/3qLZv7Rd.js";import{g as Z,s as Ye}from"../chunks/C07Td5iz.js";import{b as _e,a as Fe,t as Je,n as Qe,o as Xe,q as Ze,s as ea,u as aa,v as sa,w as Te,m as ta,l as na}from"../chunks/y7-MpCW8.js";import{s as Ne}from"../chunks/D4-J_OgU.js";import{e as oa}from"../chunks/qLEJnVdX.js";function Se(l,r){var s=l.$$events?.[r.type],_=Le(s)?s.slice():s==null?[]:[s];for(var P of _)P.call(this,r)}const Ee="tc_theme";function ia(){try{const l=localStorage.getItem(Ee);return l==="dark"||l==="light"?l:null}catch{return null}}function Ie(l){if(typeof document>"u")return;const r=document.documentElement;r.dataset.theme=l,r.style.colorScheme=l}const fe=Oe("light");function ra(){if(typeof window>"u")return Pe(fe);const l=ia(),r=document.documentElement?.dataset?.theme,s=l||(r==="dark"||r==="light"?r:"light");return fe.set(s),Ie(s),s}function la(l){const r=l==="dark"?"dark":"light";fe.set(r),Ie(r);try{localStorage.setItem(Ee,r)}catch{}return r}function ca(){const l=Pe(fe);return la(l==="dark"?"light":"dark")}var va=v('<div class="brand brand-disabled svelte-d8j1hi"><div class="brand-mark svelte-d8j1hi">TC</div> <div class="brand-text svelte-d8j1hi"><span class="brand-eyebrow svelte-d8j1hi">Panel</span> <span class="brand-name svelte-d8j1hi">TransConecta</span></div></div>'),da=v('<button class="brand svelte-d8j1hi"><div class="brand-mark svelte-d8j1hi">TC</div> <div class="brand-text svelte-d8j1hi"><span class="brand-eyebrow svelte-d8j1hi">Panel</span> <span class="brand-name svelte-d8j1hi">TransConecta</span></div></button>'),ua=v('<button class="menu-item svelte-d8j1hi"><span class="ms-icon svelte-d8j1hi">view_quilt</span> <span>M贸dulos</span></button>'),ma=v('<div class="user-menu svelte-d8j1hi" role="menu" tabindex="-1"><button class="menu-item svelte-d8j1hi"><span class="ms-icon svelte-d8j1hi">account_circle</span> <span>Mi Perfil</span></button> <button class="menu-item svelte-d8j1hi"><span class="ms-icon svelte-d8j1hi">vpn_key</span> <span>Cambiar contrase帽a</span></button> <!> <button class="menu-item danger svelte-d8j1hi"><span class="ms-icon svelte-d8j1hi">logout</span> <span>Cerrar sesi贸n</span></button></div>'),pa=v('<div class="right svelte-d8j1hi"><button class="icon-btn svelte-d8j1hi"><span class="ms-icon"> </span></button> <button class="user-pill svelte-d8j1hi" aria-haspopup="true"><span class="dot svelte-d8j1hi"></span> <div class="user-meta svelte-d8j1hi"><span class="user-name svelte-d8j1hi"> </span> <span class="user-role svelte-d8j1hi"> </span></div> <span class="ms-icon caret svelte-d8j1hi"> </span></button> <!></div>'),fa=v('<nav class="navbar svelte-d8j1hi"><div class="navbar-container svelte-d8j1hi"><div class="left svelte-d8j1hi"><button class="icon-btn svelte-d8j1hi" aria-label="Abrir men煤"><span class="ms-icon">menu</span></button> <!></div> <!></div></nav>');function ha(l,r){ke(r,!1);const s=()=>re(ie,"$auth",_),[_,P]=ge(),G=He();let f=d(!1),y=d("light");Me(()=>{a(y,ra());const t=fe.subscribe(n=>{a(y,n)});return()=>t()});function R(){G("toggle")}function T(){if(_e("dashboard","ver")){Z("/");return}_e("registroHoras","ver")&&Z("/operaciones/horas")}function $(){We(),window.location.replace("/login")}function M(t){t.stopPropagation(),a(f,!e(f))}function D(){a(f,!1),Z("/perfil")}function U(){a(f,!1),Z("/cambiar-contrasena")}function O(){a(f,!1),Z("/modulos")}function W(){a(f,!1),$()}function g(){ca()}Ae();var b=fa();I("click",Ve,()=>a(f,!1));var N=m(b),S=m(N),J=m(S),Q=p(J,2);{var ee=t=>{var n=va();o(t,n)},ae=t=>{var n=da();I("click",n,T),o(t,n)};h(Q,t=>{_e("dashboard","ver")?t(ae,!1):t(ee)})}u(S);var le=p(S,2);{var ce=t=>{var n=pa(),c=m(n),k=m(c),B=m(k,!0);u(k),u(c);var j=p(c,2),q=p(m(j),2),H=m(q),C=m(H,!0);u(H);var L=p(H,2),se=m(L,!0);u(L),u(q);var te=p(q,2),ne=m(te,!0);u(te),u(j);var V=p(j,2);{var Y=X=>{var i=ma(),A=m(i),K=p(A,2),F=p(K,2);{var ve=E=>{var w=ua();I("click",w,O),o(E,w)};h(F,E=>{_e("modulos","ver")&&E(ve)})}var de=p(F,2);u(i),I("click",A,D),I("click",K,U),I("click",de,W),I("click",i,xe(function(E){Se.call(this,r,E)})),I("keydown",i,xe(function(E){Se.call(this,r,E)})),o(X,i)};h(V,X=>{e(f)&&X(Y)})}u(n),Ce(()=>{ye(c,"aria-label",e(y)==="dark"?"Cambiar a modo claro":"Cambiar a modo oscuro"),ye(c,"title",e(y)==="dark"?"Modo claro":"Modo oscuro"),pe(B,e(y)==="dark"?"light_mode":"dark_mode"),ye(j,"aria-expanded",e(f)),pe(C,s().usuario?.nombre_usuario||"Usuario"),pe(se,s().nombre_rol||s().usuario?.nombre_rol||"Rol"),pe(ne,e(f)?"expand_less":"expand_more")}),I("click",c,g),I("click",j,M),o(t,n)};h(le,t=>{s().isAuthenticated&&t(ce)})}u(N),u(b),I("click",J,R),o(l,b),je(),P()}var _a=v('<div class="nav-section svelte-181dlmc"><h3 class="svelte-181dlmc">Dashboard</h3> <ul class="svelte-181dlmc"><li class="svelte-181dlmc"><a href="/" class="svelte-181dlmc"><span class="ms-icon nav-icon svelte-181dlmc">home</span> <span>Inicio</span></a></li></ul></div>'),ga=v('<li class="svelte-181dlmc"><a href="/usuarios" class="svelte-181dlmc"><span class="ms-icon nav-icon svelte-181dlmc">group</span><span>Usuarios</span></a></li>'),ba=v('<li class="svelte-181dlmc"><a href="/clientes" class="svelte-181dlmc"><span class="ms-icon nav-icon svelte-181dlmc">diversity_3</span><span>Clientes</span></a></li>'),ya=v('<li class="svelte-181dlmc"><a href="/roles" class="svelte-181dlmc"><span class="ms-icon nav-icon svelte-181dlmc">admin_panel_settings</span><span>Roles</span></a></li>'),ka=v('<li class="svelte-181dlmc"><a href="/vehiculos" class="svelte-181dlmc"><span class="ms-icon nav-icon svelte-181dlmc">local_shipping</span><span>Veh铆culos</span></a></li>'),ja=v('<li class="svelte-181dlmc"><a href="/conductores" class="svelte-181dlmc"><span class="ms-icon nav-icon svelte-181dlmc">badge</span><span>Conductores</span></a></li>'),Ca=v('<li class="svelte-181dlmc"><a href="/trayectos" class="svelte-181dlmc"><span class="ms-icon nav-icon svelte-181dlmc">map</span><span>Trayectos</span></a></li>'),Aa=v('<div class="nav-section svelte-181dlmc"><h3 class="svelte-181dlmc">Gesti贸n</h3> <ul class="svelte-181dlmc"><!> <!> <!> <!> <!> <!></ul></div>'),wa=v('<li class="svelte-181dlmc"><a href="/asignaciones" class="svelte-181dlmc"><span class="ms-icon nav-icon svelte-181dlmc">route</span><span>Asignaciones</span></a></li>'),xa=v('<li class="svelte-181dlmc"><a href="/operaciones/horas" class="svelte-181dlmc"><span class="ms-icon nav-icon svelte-181dlmc">schedule</span><span>Registro de Horas</span></a></li>'),$a=v('<div class="nav-section svelte-181dlmc"><h3 class="svelte-181dlmc">Operaciones</h3> <ul class="svelte-181dlmc"><!> <!></ul></div>'),Ta=v('<aside><nav class="nav-menu svelte-181dlmc"><!> <!> <!></nav></aside>');function Sa(l,r){ke(r,!1);const s=()=>re(ta,"$modulosConfig",P),_=()=>re(ie,"$auth",P),[P,G]=ge(),f=d(),y=d();let R=Ue(r,"open",8,!1),T=d(!1),$=d(!1),M=d(!1),D=d(!1),U=d(!1),O=d(!1),W=d(!1),g=d(!1),b=d(!1);x(()=>s(),()=>{a(f,s())}),x(()=>_(),()=>{a(y,_().usuario)}),x(()=>(e(f),_(),Te),()=>{e(f),_(),a(T,Fe("dashboard")),a($,Je()),a(M,Qe()),a(D,Xe()),a(U,Ze()),a(O,ea()),a(W,aa()),a(g,sa()),a(b,Te())}),Re(),Ae();var N=Ta();let S;var J=m(N),Q=m(J);{var ee=n=>{var c=_a();o(n,c)};h(Q,n=>{e(T)&&n(ee)})}var ae=p(Q,2);{var le=n=>{var c=Aa(),k=p(m(c),2),B=m(k);{var j=i=>{var A=ga();o(i,A)};h(B,i=>{e($)&&i(j)})}var q=p(B,2);{var H=i=>{var A=ba();o(i,A)};h(q,i=>{e(D)&&i(H)})}var C=p(q,2);{var L=i=>{var A=ya();o(i,A)};h(C,i=>{e(M)&&i(L)})}var se=p(C,2);{var te=i=>{var A=ka();o(i,A)};h(se,i=>{e(U)&&i(te)})}var ne=p(se,2);{var V=i=>{var A=ja();o(i,A)};h(ne,i=>{e(O)&&i(V)})}var Y=p(ne,2);{var X=i=>{var A=Ca();o(i,A)};h(Y,i=>{e(W)&&i(X)})}u(k),u(c),o(n,c)};h(ae,n=>{(e($)||e(M)||e(D)||e(U)||e(O)||e(W))&&n(le)})}var ce=p(ae,2);{var t=n=>{var c=$a(),k=p(m(c),2),B=m(k);{var j=C=>{var L=wa();o(C,L)};h(B,C=>{e(g)&&C(j)})}var q=p(B,2);{var H=C=>{var L=xa();o(C,L)};h(q,C=>{e(b)&&C(H)})}u(k),u(c),o(n,c)};h(ce,n=>{(e(g)||e(b))&&n(t)})}u(J),u(N),Ce(()=>S=Ne(N,1,"sidebar svelte-181dlmc",null,S,{open:R(),collapsed:!R()})),o(l,N),je(),G()}var qa=v('<div><div class="dot svelte-90e3ac"></div> <span> </span></div>'),Pa=v('<div class="notificaciones-container svelte-90e3ac"></div>');function qe(l){const r=()=>re(Be,"$notificaciones",s),[s,_]=ge();var P=Pa();oa(P,5,r,G=>G.id,(G,f)=>{var y=qa(),R=p(m(y),2),T=m(R,!0);u(R),u(y),Ce(()=>{Ne(y,1,`notificacion notificacion-${e(f).tipo}`,"svelte-90e3ac"),pe(T,e(f).mensaje)}),o(G,y)}),u(P),o(l,P),_()}const Ma=()=>{const l=Ye;return{page:{subscribe:l.page.subscribe},navigating:{subscribe:l.navigating.subscribe},updated:l.updated}},Ra={subscribe(l){return Ma().page.subscribe(l)}};var Ua=v('<div class="login-wrapper svelte-12qhfyh"><!> <!></div>'),Na=v('<div class="layout svelte-12qhfyh"><main class="content full-width svelte-12qhfyh"><div style="display: flex; justify-content: center; align-items: center; min-height: 60vh;"><div style="text-align: center;"><div class="spinner" style="margin: 0 auto 16px;"></div> <p>Cerrando sesi贸n...</p></div></div></main></div>'),Ea=v('<main class="content full-width svelte-12qhfyh"><div style="display: flex; justify-content: center; align-items: center; min-height: 60vh;"><div style="text-align: center;"><div class="spinner" style="margin: 0 auto 16px;"></div> <p>Inicializando...</p></div></div></main>'),Ia=v('<!> <main class="content svelte-12qhfyh"><!></main>',1),Da=v('<main class="content full-width svelte-12qhfyh"><div style="display: flex; justify-content: center; align-items: center; min-height: 60vh;"><div style="text-align: center;"><div class="spinner" style="margin: 0 auto 16px;"></div> <p>Cargando permisos...</p></div></div></main>'),Oa=v('<main class="content full-width svelte-12qhfyh"><div style="display: flex; justify-content: center; align-items: center; min-height: 60vh;"><div style="text-align: center;"><div class="spinner" style="margin: 0 auto 16px;"></div> <p>Cargando perfil...</p></div></div></main>'),Ha=v('<main class="content full-width svelte-12qhfyh"><!></main>'),La=v('<div class="layout svelte-12qhfyh"><!> <div class="main-container svelte-12qhfyh"><!></div> <!></div>');function ns(l,r){ke(r,!1);const s=()=>re(ie,"$auth",P),_=()=>re(Ra,"$page",P),[P,G]=ge(),f=d(),y=d(),R=d(),T=d(),$=d(),M=d(),D=d(),U=d();let O=Ue(r,"data",8),W=d(!0),g=d(!1),b=d(!1),N=d(!1),S=d(!1);if(typeof window<"u"){const t=localStorage.getItem("auth_token"),n=document.cookie.split("; ").find(k=>k.startsWith("auth_token="))?.split("=")[1],c=t||n;c&&(localStorage.setItem("auth_token",c),me.setToken(c),ie.update(k=>({...k,token:c,isAuthenticated:!0})))}Me(async()=>{me.getToken()&&!e(b)&&await Q(),a(g,!0)}),O()?.token&&ie.update(t=>({...t,token:O().token,isAuthenticated:!0}));function J(){a(W,!e(W))}async function Q(){if(!me.getToken()){a(b,!0);return}try{const t=await me.me();Ke(t.usuario),a(b,!0)}catch(t){console.error("Error cargando perfil:",t),me.logout(),ie.update(n=>({...n,token:null,usuario:null,nombre_rol:null,isAuthenticated:!1})),a(b,!0)}}x(()=>(e(g),s(),ze(O())),()=>{a(f,e(g)?s().isAuthenticated:!!O()?.token)}),x(()=>_(),()=>{a(y,_().route.id==="/login")}),x(()=>_(),()=>{a(R,_().route.id==="/recuperar-contrasena")}),x(()=>_(),()=>{a(T,_().route.id==="/cambiar-contrasena")}),x(()=>s(),()=>{a($,s()?.usuario?.requiere_cambio_contrasena===!0)}),x(()=>(e(y),e(R)),()=>{a(M,e(y)||e(R))}),x(()=>(e(M),e(T),e($)),()=>{a(D,e(M)||e(T)&&e($))}),x(()=>(e(g),_(),e(f),e($),e(D),e(T)),()=>{e(g)&&console.log(" Layout Debug:",{route:_().route.id,isAuthed:e(f),requiereCambioContrasena:e($),mostrarSinNavegacion:e(D),isCambiarContrasenaPage:e(T)})}),x(()=>(s(),e(N)),()=>{s().isAuthenticated!==e(N)&&(a(N,s().isAuthenticated),s().isAuthenticated?(a(b,!1),a(S,!1)):(a(b,!0),a(S,!1)))}),x(()=>(e(b),s()),()=>{a(U,e(b)&&(s().usuario!==null||!s().isAuthenticated))}),x(()=>(e(g),s(),e(b),e(M),e($)),()=>{e(g)&&s().isAuthenticated&&!e(b)&&!e(M)&&!e($)&&Q()}),x(()=>(e(g),s(),e(U),e(S),$e),()=>{if(e(g)&&s().isAuthenticated&&e(U)&&!e(S)){const t=s().usuario?.nombre_rol?.toUpperCase();(t?na(t):Promise.resolve()).then(()=>{a(S,!0)}).catch(c=>{console.warn("No se pudieron sincronizar los permisos de m贸dulos",c),$e("No se pudieron cargar permisos de m贸dulos; usando valores por defecto","warning"),a(S,!0)})}}),x(()=>(e(g),e($),e(T),e(M),Z),()=>{e(g)&&e($)&&!e(T)&&!e(M)&&(console.log("锔 Usuario requiere cambio de contrase帽a, redirigiendo..."),Z("/cambiar-contrasena",{replaceState:!0}))}),Re(),Ae();var ee=ue(),ae=oe(ee);{var le=t=>{var n=Ua(),c=m(n);be(c,r,"default",{});var k=p(c,2);qe(k),u(n),o(t,n)},ce=t=>{var n=ue(),c=oe(n);{var k=j=>{var q=Na();o(j,q)},B=j=>{var q=La(),H=m(q);ha(H,{$$events:{toggle:J}});var C=p(H,2),L=m(C);{var se=V=>{var Y=Ea();o(V,Y)},te=V=>{var Y=ue(),X=oe(Y);{var i=K=>{var F=ue(),ve=oe(F);{var de=w=>{var z=Ia(),he=oe(z);Sa(he,{get open(){return e(W)}});var we=p(he,2),De=m(we);be(De,r,"default",{}),u(we),o(w,z)},E=w=>{var z=Da();o(w,z)};h(ve,w=>{e(S)?w(de):w(E,!1)})}o(K,F)},A=K=>{var F=ue(),ve=oe(F);{var de=w=>{var z=Oa();o(w,z)},E=w=>{var z=Ha(),he=m(z);be(he,r,"default",{}),u(z),o(w,z)};h(ve,w=>{e(f)&&!e(U)?w(de):w(E,!1)},!0)}o(K,F)};h(X,K=>{e(f)&&e(U)?K(i):K(A,!1)},!0)}o(V,Y)};h(L,V=>{e(g)?V(te,!1):V(se)})}u(C);var ne=p(C,2);qe(ne),u(q),o(j,q)};h(c,j=>{s(),Ge(()=>s().loggingOut)?j(k):j(B,!1)},!0)}o(t,n)};h(ae,t=>{e(D)?t(le):t(ce,!1)})}o(l,ee),je(),G()}export{ns as component};
