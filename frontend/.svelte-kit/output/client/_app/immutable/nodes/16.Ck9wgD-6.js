import"../chunks/DsnmJJEf.js";import"../chunks/2J32lFCu.js";import{r as Z,u as D,ab as ia,ao as aa,aI as na,at as la,au as ca,av as da,aq as F,aw as K,b as t,a as R,ax as pa,az as m,ar as o,s as b,W as M,aC as Y,ay as ua,as as r}from"../chunks/DdWuALZu.js";import{e as T,a as q}from"../chunks/D5sqcERo.js";import{e as ma,i as va}from"../chunks/qLEJnVdX.js";import{h as fa}from"../chunks/CgsUcASs.js";import{r as $,s as V}from"../chunks/DjPkcCDc.js";import{b as X}from"../chunks/CnWbZhhT.js";import{i as xa}from"../chunks/-w5iKcy_.js";import{p as ba}from"../chunks/_X9-3qsY.js";import{i as ga,a as ha,b as ya,c as za,g as U}from"../chunks/C07Td5iz.js";import{b as _,j as _a,i as wa,s as ka}from"../chunks/3qLZv7Rd.js";function Aa(s,v,d){Z(()=>{var l=D(()=>v(s,d?.())||{});if(d&&l?.update){var e=!1,n={};ia(()=>{var i=d();aa(i),e&&na(n,i)&&(n=i,l.update(i))}),e=!0}if(l?.destroy)return()=>l.destroy()})}function Ca(s){const v=JSON.parse(s);return v.data&&(v.data=ya(v.data,za.decoders)),v}function O(s){return HTMLElement.prototype.cloneNode.call(s)}function Sa(s,v=()=>{}){const d=async({action:e,result:n,reset:i=!0,invalidateAll:x=!0})=>{n.type==="success"&&(i&&HTMLFormElement.prototype.reset.call(s),x&&await ga()),(location.origin+location.pathname===e.origin+e.pathname||n.type==="redirect"||n.type==="error")&&await ha(n)};async function l(e){if((e.submitter?.hasAttribute("formmethod")?e.submitter.formMethod:O(s).method)!=="post")return;e.preventDefault();const i=new URL(e.submitter?.hasAttribute("formaction")?e.submitter.formAction:O(s).action),x=e.submitter?.hasAttribute("formenctype")?e.submitter.formEnctype:O(s).enctype,g=new FormData(s,e.submitter),S=new AbortController;let E=!1;const w=await v({action:i,cancel:()=>E=!0,controller:S,formData:g,formElement:s,submitter:e.submitter})??d;if(E)return;let f;try{const c=new Headers({accept:"application/json","x-sveltekit-action":"true"});x!=="multipart/form-data"&&c.set("Content-Type",/^(:?application\/x-www-form-urlencoded|text\/plain)$/.test(x)?x:"application/x-www-form-urlencoded");const k=x==="multipart/form-data"?g:new URLSearchParams(g),h=await fetch(i,{method:"POST",headers:c,cache:"no-store",body:k,signal:S.signal});f=Ca(await h.text()),f.type==="error"&&(f.status=h.status)}catch(c){if(c?.name==="AbortError")return;f={type:"error",error:c}}await w({action:i,formData:g,formElement:s,update:c=>d({action:i,result:f,reset:c?.reset,invalidateAll:c?.invalidateAll}),result:f})}return HTMLFormElement.prototype.addEventListener.call(s,"submit",l),{destroy(){HTMLFormElement.prototype.removeEventListener.call(s,"submit",l)}}}var Ea=F('<meta name="description" content="Inicia sesi√≥n en TransConecta"/> <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"/>',1),La=F('<button type="button" class="user-card svelte-1x05zx6" title="Clic para usar este usuario"><div class="user-avatar svelte-1x05zx6"><span class="ms-icon svelte-1x05zx6">person</span></div> <div class="user-info svelte-1x05zx6"><span class="user-nombre svelte-1x05zx6"> </span> <span class="user-rol svelte-1x05zx6"><span class="role-badge svelte-1x05zx6"> </span></span></div> <span class="ms-icon arrow svelte-1x05zx6">arrow_forward</span></button>'),Ma=F('<div class="login-shell svelte-1x05zx6"><div class="shape shape-a svelte-1x05zx6" aria-hidden="true"></div> <div class="shape shape-b svelte-1x05zx6" aria-hidden="true"></div> <section class="login-card svelte-1x05zx6"><header class="login-header svelte-1x05zx6"><p class="eyebrow svelte-1x05zx6">Plataforma log√≠stica</p> <h1 class="svelte-1x05zx6">TransConecta</h1> <p class="subtitle svelte-1x05zx6">Opera tu red de transporte con seguridad y claridad.</p></header> <form method="POST" action="?/login" class="svelte-1x05zx6"><div class="form-grid svelte-1x05zx6"><label class="form-field svelte-1x05zx6"><span class="svelte-1x05zx6">Correo electr√≥nico</span> <input type="email" id="correo" name="correo" placeholder="correo@example.com" required class="svelte-1x05zx6"/></label> <label class="form-field svelte-1x05zx6"><span class="svelte-1x05zx6">Contrase√±a</span> <div class="password-wrapper svelte-1x05zx6"><input id="contrase√±a" name="contrase√±a" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required class="svelte-1x05zx6"/> <button type="button" class="toggle-password svelte-1x05zx6"><span class="ms-icon svelte-1x05zx6"> </span></button></div></label></div> <button type="submit" class="login-btn svelte-1x05zx6"> </button> <div class="form-footer svelte-1x05zx6"><button type="button" class="link-button svelte-1x05zx6">¬øOlvidaste tu contrase√±a?</button></div></form> <div class="login-footer svelte-1x05zx6"><div class="footer-header svelte-1x05zx6"><span class="ms-icon svelte-1x05zx6">group</span> <p class="footer-title svelte-1x05zx6">Usuarios de prueba</p></div> <p class="footer-subtitle svelte-1x05zx6">Haz clic en un usuario para autocompletar las credenciales</p> <div class="users-grid svelte-1x05zx6"></div></div></section></div>');function Wa(s,v){la(v,!1);let d=M(""),l=M(""),e=M(!1),n=M(!1),i=ba(v,"form",8);function x(){console.log("üîÑ Navegando a recuperar contrase√±a..."),U("/recuperar-contrasena")}function g(a){a.key==="Enter"&&t(d)&&t(l)&&!t(e)&&document.querySelector("form").requestSubmit()}function S(){b(n,!t(n))}const E=[{nombre:"Mauricio Fern√°ndez",rol:"Coordinador",correo:"mauriciofernandez@gmail.com",contrase√±a:"Maufz_2025$2"},{nombre:"Mayra Alejandra Hoyos",rol:"HSEQ",correo:"mayraalejandrahoyos@gmail.com",contrase√±a:"MayraH@2025!"},{nombre:"Wilfran Camilo Castellanos",rol:"Administrador",correo:"wilfrancamilocastellanos@gmail.com",contrase√±a:"WccAdmin#92"},{nombre:"Yeison Ram√≠rez",rol:"Coordinador",correo:"jasonramirez@gmail.com",contrase√±a:"JasonR*884"}];function I(a){b(d,a.correo),b(l,a.contrase√±a)}ca(()=>(aa(i()),_),()=>{i()?.error&&_(i().error,"error")}),da(),xa();var w=Ma();fa("1x05zx6",a=>{var p=Ea();Y(2),Z(()=>{ua.title="Login - TransConecta"}),R(a,p)});var f=m(o(w),4),c=m(o(f),2),k=o(c),h=o(k),H=m(o(h),2);$(H),r(h);var j=m(h,2),N=m(o(j),2),y=o(N);$(y);var A=m(y,2),P=o(A),ea=o(P,!0);r(P),r(A),r(N),r(j),r(k);var L=m(k,2),ta=o(L,!0);r(L);var W=m(L,2),ra=o(W);r(W),r(c),Aa(c,(a,p)=>Sa?.(a,p),()=>()=>(b(e,!0),async({result:a,update:p})=>{if(b(e,!1),console.log("üîç Login result:",a),console.log("üîç Result data:",a.data),console.log("üîç Usuario:",a.data?.usuario),console.log("üîç Requiere cambio:",a.data?.usuario?.requiere_cambio_contrasena),a.type==="success"&&a.data?.success!==!1){const u=a.data?.token?String(a.data.token):null;if(u){if(localStorage.setItem("auth_token",u),_a.setToken(u),wa.update(C=>({...C,token:u,isAuthenticated:!0})),a.data?.usuario&&ka(a.data.usuario),a.data?.usuario?.requiere_cambio_contrasena){console.log("‚úÖ Usuario requiere cambio de contrase√±a, redirigiendo..."),_("Debes cambiar tu contrase√±a antes de continuar","warning"),await p(),await U("/cambiar-contrasena",{replaceState:!0});return}console.log("‚úÖ Login normal, redirigiendo al dashboard..."),_("¬°Bienvenido a TransConecta!","success"),await p();let z="/";a.data?.usuario?.nombre_rol?.toUpperCase()==="HSEQ"?z="/operaciones/horas":a.data?.location&&(z=String(a.data.location)),await U(z,{replaceState:!0})}else _("No se recibi√≥ token del servidor","error")}else{const u=a.data?.error||"Error al iniciar sesi√≥n";_(u,"error")}}));var J=m(c,2),Q=m(o(J),4);ma(Q,5,()=>E,va,(a,p)=>{var u=La(),z=m(o(u),2),C=o(z),sa=o(C,!0);r(C);var B=m(C,2),G=o(B),oa=o(G,!0);r(G),r(B),r(z),Y(2),r(u),K(()=>{u.disabled=t(e),q(sa,(t(p),D(()=>t(p).nombre))),q(oa,(t(p),D(()=>t(p).rol)))}),T("click",u,()=>I(t(p))),R(a,u)}),r(Q),r(J),r(f),r(w),K(()=>{H.disabled=t(e),V(y,"type",t(n)?"text":"password"),y.disabled=t(e),V(A,"aria-label",t(n)?"Ocultar contrase√±a":"Mostrar contrase√±a"),A.disabled=t(e),q(ea,t(n)?"visibility_off":"visibility"),L.disabled=t(e)||!t(d)||!t(l),q(ta,t(e)?"Iniciando sesi√≥n...":"Ingresar")}),X(H,()=>t(d),a=>b(d,a)),X(y,()=>t(l),a=>b(l,a)),T("keydown",y,g),T("click",A,S),T("click",ra,x),R(s,w),pa()}export{Wa as component};
