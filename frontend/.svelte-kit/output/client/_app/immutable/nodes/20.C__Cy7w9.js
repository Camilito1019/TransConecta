import"../chunks/DsnmJJEf.js";import"../chunks/2J32lFCu.js";import{at as Ge,au as F,av as We,aq as C,aw as G,a as d,ax as Be,b as e,W as m,r as He,ar as t,az as o,s as n,ay as Ke,as as r,aE as ee,c as ae,f as se,u as ye}from"../chunks/DdWuALZu.js";import{e as T,a as R}from"../chunks/D5sqcERo.js";import{i as y}from"../chunks/DNIL3y1X.js";import{h as Qe}from"../chunks/CgsUcASs.js";import{r as W,s as oe}from"../chunks/DjPkcCDc.js";import{s as I}from"../chunks/D4-J_OgU.js";import{b as B}from"../chunks/CnWbZhhT.js";import{p as te}from"../chunks/CdEA5IGF.js";import{i as Ue}from"../chunks/-w5iKcy_.js";import{g as Ce}from"../chunks/C07Td5iz.js";import{b as _}from"../chunks/3qLZv7Rd.js";var Xe=C('<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"/>'),Ye=C('<form class="svelte-jwh3ob"><div class="form-field svelte-jwh3ob"><label for="correo" class="svelte-jwh3ob">Correo electr√≥nico</label> <input type="email" id="correo" placeholder="correo@example.com" required class="svelte-jwh3ob"/></div> <button type="submit" class="btn-primary svelte-jwh3ob"> </button></form>'),Ze=C('<form class="svelte-jwh3ob"><div class="info-box svelte-jwh3ob"><span class="ms-icon svelte-jwh3ob">mail</span> <p class="svelte-jwh3ob">Enviamos un c√≥digo de 6 d√≠gitos a <strong> </strong></p></div> <div class="form-field svelte-jwh3ob"><label for="codigo" class="svelte-jwh3ob">C√≥digo de verificaci√≥n</label> <input type="text" id="codigo" placeholder="000000" maxlength="6" inputmode="numeric" autocomplete="one-time-code" class="otp-input svelte-jwh3ob"/> <small class="svelte-jwh3ob"> </small></div> <button type="submit" class="btn-primary svelte-jwh3ob"> </button> <button type="button" class="btn-secondary svelte-jwh3ob">Reenviar c√≥digo</button></form>'),$e=C('<small class="error-text svelte-jwh3ob">‚ö†Ô∏è La contrase√±a debe tener al menos 6 caracteres</small>'),ea=C('<small class="success-text svelte-jwh3ob">‚úì Contrase√±a v√°lida</small>'),aa=C('<small class="error-text svelte-jwh3ob">‚ö†Ô∏è Las contrase√±as no coinciden</small>'),sa=C('<small class="success-text svelte-jwh3ob">‚úì Las contrase√±as coinciden</small>'),oa=C('<form class="svelte-jwh3ob"><div class="form-field svelte-jwh3ob"><label for="nueva_contrasena" class="svelte-jwh3ob">Nueva contrase√±a</label> <div class="password-wrapper svelte-jwh3ob"><input id="nueva_contrasena" placeholder="M√≠nimo 6 caracteres" required class="svelte-jwh3ob"/> <button type="button" class="toggle-password svelte-jwh3ob"><span class="ms-icon"> </span></button></div> <!></div> <div class="form-field svelte-jwh3ob"><label for="confirmar_contrasena" class="svelte-jwh3ob">Confirmar contrase√±a</label> <div class="password-wrapper svelte-jwh3ob"><input id="confirmar_contrasena" placeholder="Confirma tu contrase√±a" required class="svelte-jwh3ob"/> <button type="button" class="toggle-password svelte-jwh3ob"><span class="ms-icon"> </span></button></div> <!></div> <button type="submit" class="btn-primary svelte-jwh3ob"> </button></form>'),ta=C('<div class="recovery-shell svelte-jwh3ob"><div class="shape shape-a svelte-jwh3ob" aria-hidden="true"></div> <div class="shape shape-b svelte-jwh3ob" aria-hidden="true"></div> <section class="recovery-card svelte-jwh3ob"><header class="recovery-header svelte-jwh3ob"><button class="back-btn svelte-jwh3ob" aria-label="Volver al login"><span class="ms-icon">arrow_back</span></button> <h1 class="svelte-jwh3ob">Recuperar Contrase√±a</h1> <p class="subtitle svelte-jwh3ob"><!></p></header> <div class="steps-indicator svelte-jwh3ob"><div><span class="step-number svelte-jwh3ob">1</span> <span class="step-label svelte-jwh3ob">Correo</span></div> <div></div> <div><span class="step-number svelte-jwh3ob">2</span> <span class="step-label svelte-jwh3ob">C√≥digo</span></div> <div></div> <div><span class="step-number svelte-jwh3ob">3</span> <span class="step-label svelte-jwh3ob">Nueva contrase√±a</span></div></div> <!> <!> <!></section></div>');function _a(xe,ke){Ge(ke,!1);const V=m(),S=m(),H=m();let p=m(1),g=m(""),w=m(""),c=m(""),x=m(""),O=m(""),l=m(!1),D=m(!1),J=m(!1),re=m(3);function Ee(a){return a.replace(/\D/g,"").slice(0,6)}async function le(){if(!e(g)){_("Por favor ingresa tu correo","error");return}n(l,!0);try{console.log("Enviando solicitud OTP para:",e(g));const a=await fetch("http://localhost:3000/api/solicitar-otp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({correo:e(g)})});console.log("Respuesta status:",a.status);const s=await a.json();if(console.log("Respuesta data:",s),!a.ok)throw new Error(s.error||"Error al solicitar c√≥digo");_("C√≥digo enviado a tu correo","success"),n(p,2)}catch(a){console.error("Error al solicitar OTP:",a),_(a.message,"error")}finally{n(l,!1)}}async function Te(){if(!e(w)||e(w).length!==6){_("Ingresa un c√≥digo de 6 d√≠gitos","error");return}n(l,!0);try{const a=await fetch("http://localhost:3000/api/verificar-otp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({correo:e(g),codigo:e(w)})}),s=await a.json();if(!a.ok)throw s.intentosRestantes!==void 0&&n(re,s.intentosRestantes),new Error(s.error||"C√≥digo incorrecto");n(O,s.token),_("C√≥digo verificado correctamente","success"),n(p,3)}catch(a){_(a.message,"error")}finally{n(l,!1)}}async function Re(){if(console.log("üîÑ restablecerContrasena llamada"),console.log("üìß Correo:",e(g)),console.log("üîë Token:",e(O)),console.log("üîí Nueva contrase√±a:",e(c)?"***":"vac√≠a"),console.log("‚úÖ Confirmar contrase√±a:",e(x)?"***":"vac√≠a"),!e(c)||e(c).length<6){console.log("‚ùå Error: contrase√±a muy corta"),_("La contrase√±a debe tener al menos 6 caracteres","error");return}if(e(c)!==e(x)){console.log("‚ùå Error: contrase√±as no coinciden"),_("Las contrase√±as no coinciden","error");return}if(!e(O)){console.log("‚ùå Error: token no disponible"),_("Token no disponible. Por favor verifica el c√≥digo OTP nuevamente","error");return}n(l,!0);try{console.log("üì§ Enviando petici√≥n al backend...");const a=await fetch("http://localhost:3000/api/restablecer-contrasena",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({correo:e(g),token:e(O),nueva_contrasena:e(c)})});console.log("üì• Respuesta recibida:",a.status);const s=await a.json();if(console.log("üì¶ Data:",s),!a.ok)throw new Error(s.error||"Error al restablecer contrase√±a");console.log("‚úÖ Contrase√±a restablecida exitosamente"),_("Contrase√±a restablecida exitosamente","success"),setTimeout(()=>Ce("/login"),2e3)}catch(a){console.error("‚ùå Error al restablecer:",a),_(a.message,"error")}finally{n(l,!1)}}function Oe(){Ce("/login")}F(()=>e(c),()=>{n(V,e(c)&&e(c).length>=6)}),F(()=>(e(c),e(x)),()=>{n(S,e(c)&&e(x)&&e(c)===e(x))}),F(()=>(e(V),e(S),e(O),e(l)),()=>{n(H,e(V)&&e(S)&&e(O)&&!e(l))}),F(()=>e(w),()=>{n(w,Ee(e(w)))}),We(),Ue();var K=ta();Qe("jwh3ob",a=>{var s=Xe();He(()=>{Ke.title="Recuperar Contrase√±a - TransConecta"}),d(a,s)});var ne=o(t(K),4),Q=t(ne),ie=t(Q),ce=o(ie,4),Pe=t(ce);{var Le=a=>{var s=ee("Ingresa tu correo para recibir un c√≥digo de verificaci√≥n");d(a,s)},Ne=a=>{var s=ae(),u=se(s);{var f=v=>{var h=ee("Ingresa el c√≥digo que enviamos a tu correo");d(v,h)},b=v=>{var h=ee("Crea una nueva contrase√±a segura");d(v,h)};y(u,v=>{e(p)===2?v(f):v(b,!1)},!0)}d(a,s)};y(Pe,a=>{e(p)===1?a(Le):a(Ne,!1)})}r(ce),r(Q);var U=o(Q,2),ve=t(U);let de;var pe=o(ve,2);let be;var ue=o(pe,2);let me;var fe=o(ue,2);let he;var Se=o(fe,2);let _e;r(U);var ge=o(U,2);{var qe=a=>{var s=Ye(),u=t(s),f=o(t(u),2);W(f),r(u);var b=o(u,2),v=t(b,!0);r(b),r(s),G(()=>{f.disabled=e(l),b.disabled=e(l)||!e(g),R(v,e(l)?"Enviando...":"Enviar c√≥digo")}),B(f,()=>e(g),h=>n(g,h)),T("submit",s,te(le)),d(a,s)};y(ge,a=>{e(p)===1&&a(qe)})}var we=o(ge,2);{var Ie=a=>{var s=Ze(),u=t(s),f=o(t(u),2),b=o(t(f)),v=t(b,!0);r(b),r(f),r(u);var h=o(u,2),P=o(t(h),2);W(P);var z=o(P,2),X=t(z);r(z),r(h);var L=o(h,2),q=t(L,!0);r(L);var N=o(L,2);r(s),G(()=>{R(v,e(g)),P.disabled=e(l),R(X,`Intentos restantes: ${e(re)??""}`),L.disabled=(e(l),e(w),ye(()=>e(l)||e(w).length!==6)),R(q,e(l)?"Verificando...":"Verificar c√≥digo"),N.disabled=e(l)}),B(P,()=>e(w),k=>n(w,k)),T("click",N,le),T("submit",s,te(Te)),d(a,s)};y(we,a=>{e(p)===2&&a(Ie)})}var Ve=o(we,2);{var De=a=>{var s=oa(),u=t(s),f=o(t(u),2),b=t(f);W(b);var v=o(b,2),h=t(v),P=t(h,!0);r(h),r(v),r(f);var z=o(f,2);{var X=i=>{var j=$e();d(i,j)},L=i=>{var j=ae(),Y=se(j);{var Z=E=>{var $=ea();d(E,$)};y(Y,E=>{e(V)&&E(Z)},!0)}d(i,j)};y(z,i=>{e(c),ye(()=>e(c)&&e(c).length<6)?i(X):i(L,!1)})}r(u);var q=o(u,2),N=o(t(q),2),k=t(N);W(k);var A=o(k,2),je=t(A),Je=t(je,!0);r(je),r(A),r(N);var ze=o(N,2);{var Ae=i=>{var j=aa();d(i,j)},Me=i=>{var j=ae(),Y=se(j);{var Z=E=>{var $=sa();d(E,$)};y(Y,E=>{e(S)&&E(Z)},!0)}d(i,j)};y(ze,i=>{e(x)&&!e(S)?i(Ae):i(Me,!1)})}r(q);var M=o(q,2),Fe=t(M,!0);r(M),r(s),G(()=>{oe(b,"type",e(D)?"text":"password"),b.disabled=e(l),v.disabled=e(l),R(P,e(D)?"visibility_off":"visibility"),oe(k,"type",e(J)?"text":"password"),k.disabled=e(l),A.disabled=e(l),R(Je,e(J)?"visibility_off":"visibility"),M.disabled=!e(H),oe(M,"title",e(H)?"Restablecer contrase√±a":"Completa todos los campos correctamente"),R(Fe,e(l)?"Restableciendo...":"Restablecer contrase√±a")}),B(b,()=>e(c),i=>n(c,i)),T("click",v,()=>n(D,!e(D))),B(k,()=>e(x),i=>n(x,i)),T("click",A,()=>n(J,!e(J))),T("submit",s,te(Re)),d(a,s)};y(Ve,a=>{e(p)===3&&a(De)})}r(ne),r(K),G(()=>{de=I(ve,1,"step svelte-jwh3ob",null,de,{active:e(p)>=1,completed:e(p)>1}),be=I(pe,1,"step-line svelte-jwh3ob",null,be,{completed:e(p)>1}),me=I(ue,1,"step svelte-jwh3ob",null,me,{active:e(p)>=2,completed:e(p)>2}),he=I(fe,1,"step-line svelte-jwh3ob",null,he,{completed:e(p)>2}),_e=I(Se,1,"step svelte-jwh3ob",null,_e,{active:e(p)>=3})}),T("click",ie,Oe),d(xe,K),Be()}export{_a as component};
