import"../chunks/DsnmJJEf.js";import"../chunks/2J32lFCu.js";import{o as Ie,e as $,a as _}from"../chunks/D5sqcERo.js";import{at as Le,au as j,av as qe,aq as k,aw as D,b as e,a as w,ax as Ge,W as g,r as Je,az as f,ar as c,s as o,aB as Q,ay as He,as as i,aA as Fe,aC as Ue,u as b}from"../chunks/DdWuALZu.js";import{i as ne}from"../chunks/DNIL3y1X.js";import{e as X,i as Ve}from"../chunks/qLEJnVdX.js";import{h as We}from"../chunks/CgsUcASs.js";import{s as ce}from"../chunks/DjPkcCDc.js";import{s as de}from"../chunks/D4-J_OgU.js";import{b as Ke}from"../chunks/pQeqK__H.js";import{i as Qe}from"../chunks/-w5iKcy_.js";import{s as Xe,a as ve}from"../chunks/B3jtdlFh.js";import{g as Ye}from"../chunks/C07Td5iz.js";import{b as d}from"../chunks/3qLZv7Rd.js";import{g as Ze,m as es,b as P,f as ss,h as S,i as as,M as fe,A as z,j as rs,k as ue,l as Y,r as ts}from"../chunks/y7-MpCW8.js";var os=k('<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" class="svelte-mktw6w"/>'),is=k('<p class="cambios-pendientes svelte-mktw6w">‚ö†Ô∏è Tienes cambios sin guardar</p>'),ls=k('<option class="svelte-mktw6w"> </option>'),ns=k('<div class="loading svelte-mktw6w"><div class="spinner svelte-mktw6w"></div> <p class="svelte-mktw6w">Cargando configuraci√≥n de m√≥dulos...</p></div>'),cs=k('<button type="button"><span class="ms-icon svelte-mktw6w"> </span> <span class="svelte-mktw6w"> </span></button>'),ds=k('<div class="card svelte-mktw6w"><div class="card-head svelte-mktw6w"><div class="svelte-mktw6w"><p class="label svelte-mktw6w"> </p> <h3 class="svelte-mktw6w"> </h3></div> <button type="button"><span class="svelte-mktw6w"> </span> <span class="thumb svelte-mktw6w"></span></button></div> <div class="acciones svelte-mktw6w"></div></div>'),vs=k('<div class="grid svelte-mktw6w"></div>'),fs=k('<div class="page-shell svelte-mktw6w"><div class="bg-shape shape-a svelte-mktw6w" aria-hidden="true"></div> <div class="bg-shape shape-b svelte-mktw6w" aria-hidden="true"></div> <section class="hero svelte-mktw6w"><div class="hero-text svelte-mktw6w"><p class="eyebrow svelte-mktw6w">Permisos</p> <h1 class="svelte-mktw6w">Configurar visibilidad y acciones</h1> <p class="lede svelte-mktw6w">Activa qu√© m√≥dulos aparecen en el sidebar y qu√© acciones (ver, editar, eliminar, desactivar) est√°n disponibles por rol.</p> <!></div> <div class="hero-actions svelte-mktw6w"><button class="ghost svelte-mktw6w">Restablecer rol</button> <button class="outline svelte-mktw6w">Restablecer todo</button> <button class="primary svelte-mktw6w"> </button></div></section> <section class="panel svelte-mktw6w"><div class="panel-head svelte-mktw6w"><div class="svelte-mktw6w"><p class="label svelte-mktw6w">Rol objetivo</p> <h2 class="svelte-mktw6w">Permisos para rol</h2></div> <select class="select svelte-mktw6w"></select></div> <!></section></div>');function As(pe,me){Le(me,!1);const Z=()=>ve(es,"$modulosConfig",ee),h=()=>ve(rs,"$modulosCargando",ee),[ee,ge]=Xe(),I=g(),L=g(),we={dashboard:"Dashboard",usuarios:"Usuarios",clientes:"Clientes",roles:"Roles",modulos:"Permisos",vehiculos:"Veh√≠culos",conductores:"Conductores",trayectos:"Trayectos",asignaciones:"Asignaciones",registroHoras:"Registro de Horas"},be=Ze()||"ADMINISTRADOR";let l=g(be),a=g({}),B=g(!0),N=g(!1),p=g(!1),R=g(!1),v=g(!1);Ie(async()=>{if(!P("modulos","ver")){d("No tienes permisos para gestionar permisos de m√≥dulos","error"),Ye("/");return}try{await ss(),M(e(l))}catch(s){console.warn("No se pudo cargar configuraci√≥n de m√≥dulos",s),d("No se pudo cargar la configuraci√≥n; usando valores por defecto","warning"),o(a,y(S()[e(l)]||{}))}finally{o(B,!1)}});function y(s){return JSON.parse(JSON.stringify(s||{}))}function M(s){const r=as(s)||S()[s]||{};o(a,y(r)),fe.forEach(n=>{e(a)[n]||Q(a,e(a)[n]={sidebar:!1,acciones:Object.fromEntries(z.map(t=>[t,!1]))})}),console.log("‚úÖ Configuraci√≥n sincronizada para",s,":",e(a)),o(v,!1)}async function ke(s){const r=s.target.value;if(e(v)&&!confirm("Tienes cambios sin guardar. ¬øDeseas continuar?")){s.target.value=e(l);return}o(l,r),o(v,!1),o(N,!0);try{await Y(r),M(r),d(`Permisos cargados para ${r}`,"info")}catch(n){console.error("No se pudo cargar permisos del rol seleccionado",n),d("No se pudo cargar los permisos del rol seleccionado","error"),o(a,y(S()[r]||{}))}finally{o(N,!1)}}function se(s){e(a)[s]||Q(a,e(a)[s]={sidebar:!1,acciones:Object.fromEntries(z.map(r=>[r,!1]))}),e(a)[s].acciones||Q(a,e(a)[s].acciones=Object.fromEntries(z.map(r=>[r,!1])))}function _e(s){se(s);const r=e(a)[s]?.sidebar||!1,n=!r;o(a,{...e(a),[s]:{...e(a)[s],sidebar:n}}),o(v,!0),console.log(`üîÑ Toggle sidebar ${s}: ${r} -> ${n}`)}function he(s,r){se(s);const n=e(a)[s]?.acciones?.[r]||!1,t=!n;o(a,{...e(a),[s]:{...e(a)[s],acciones:{...e(a)[s].acciones,[r]:t}}}),o(v,!0),console.log(`üîÑ Toggle acci√≥n ${s}.${r}: ${n} -> ${t}`)}async function ye(){if(!e(v)){d("No hay cambios para guardar","info");return}if(!P("modulos","editar")){d("No tienes permisos para editar permisos de m√≥dulos","error");return}o(p,!0);try{console.log("Guardando configuraci√≥n para rol:",e(l),e(a)),await ue(e(l),y(e(a))),await Y(e(l)),M(e(l)),d(`Permisos actualizados para ${e(l)}`,"success"),o(v,!1)}catch(s){console.error("Error guardando permisos",s),d(s.message||"No se pudo guardar la configuraci√≥n","error")}finally{o(p,!1)}}async function Ce(){if(confirm(`¬øEst√°s seguro de restablecer los permisos del rol ${e(l)} a sus valores por defecto?`)){if(!P("modulos","editar")){d("No tienes permisos para restablecer permisos","error");return}o(p,!0);try{const s=y(S()[e(l)]);await ue(e(l),s),await Y(e(l)),M(e(l)),d(`Permisos restablecidos para ${e(l)}`,"success"),o(v,!1)}catch(s){console.error("Error restableciendo rol",s),d(s.message||"No se pudo restablecer el rol","error")}finally{o(p,!1)}}}async function Oe(){if(confirm("¬øEst√°s seguro de restablecer TODOS los roles a sus valores por defecto? Esta acci√≥n no se puede deshacer.")){if(!P("modulos","eliminar")){d("No tienes permisos para restablecer toda la configuraci√≥n","error");return}o(R,!0);try{const s=await ts();o(a,y(s?.[e(l)]||S()[e(l)])),d("Permisos restablecidos para todos los roles","success"),o(v,!1)}catch(s){console.error("Error restableciendo configuraci√≥n",s),d(s.message||"No se pudo restablecer la configuraci√≥n completa","error")}finally{o(R,!1)}}}j(()=>Z(),()=>{o(I,Z())}),j(()=>e(I),()=>{o(L,Object.keys(e(I)||{}))}),j(()=>e(a),()=>{e(a)&&Object.keys(e(a)).length>0&&(console.log("üìä ConfigLocal actualizado:",JSON.parse(JSON.stringify(e(a)))),console.log("üìà M√≥dulos cargados:",Object.keys(e(a)).length))}),j(()=>e(v),()=>{e(v)&&console.log("üíæ Hay cambios sin guardar")}),qe(),Qe();var q=fs();We("mktw6w",s=>{var r=os();Je(()=>{He.title="Configurar M√≥dulos - TransConecta"}),w(s,r)});var G=f(c(q),4),J=c(G),$e=f(c(J),6);{var Ne=s=>{var r=is();w(s,r)};ne($e,s=>{e(v)&&s(Ne)})}i(J);var ae=f(J,2),H=c(ae),F=f(H,2),T=f(F,2),Re=c(T,!0);i(T),i(ae),i(G);var re=f(G,2),U=c(re),A=f(c(U),2);D(()=>{e(l),Fe(()=>{h(),e(B),e(L)})}),X(A,5,()=>e(L),Ve,(s,r)=>{var n=ls(),t=c(n,!0);i(n);var C={};D(()=>{_(t,e(r)),C!==(C=e(r))&&(n.value=(n.__value=e(r))??"")}),w(s,n)}),i(A),i(U);var Ae=f(U,2);{var xe=s=>{var r=ns();w(s,r)},Ee=s=>{var r=vs();X(r,5,()=>fe,n=>n,(n,t)=>{var C=ds(),V=c(C),W=c(V),K=c(W),De=c(K,!0);i(K);var te=f(K,2),Se=c(te,!0);i(te),i(W);var O=f(W,2),oe=c(O),Be=c(oe,!0);i(oe),Ue(2),i(O),i(V);var ie=f(V,2);X(ie,5,()=>z,x=>x,(x,u)=>{var m=cs(),E=c(m),Me=c(E,!0);i(E);var le=f(E,2),Te=c(le,!0);i(le),i(m),D((je,Pe,ze)=>{de(m,1,je,"svelte-mktw6w"),ce(m,"aria-pressed",Pe),m.disabled=e(p)||e(R)||e(N),_(Me,ze),_(Te,e(u))},[()=>(e(a),e(t),e(u),b(()=>`chip ${e(a)?.[e(t)]?.acciones?.[e(u)]?"chip-on":"chip-off"}`)),()=>(e(a),e(t),e(u),b(()=>!!e(a)?.[e(t)]?.acciones?.[e(u)])),()=>(e(a),e(t),e(u),b(()=>e(a)?.[e(t)]?.acciones?.[e(u)]?"check_circle":"block"))]),$("click",m,()=>he(e(t),e(u))),w(x,m)}),i(ie),i(C),D((x,u,m,E)=>{_(De,(e(t),b(()=>we[e(t)]||e(t)))),_(Se,x),de(O,1,u,"svelte-mktw6w"),ce(O,"aria-pressed",m),O.disabled=e(p)||e(R)||e(N),_(Be,E)},[()=>(e(a),e(t),b(()=>e(a)?.[e(t)]?.sidebar?"Visible en men√∫":"Oculto en men√∫")),()=>(e(a),e(t),b(()=>`toggle ${e(a)?.[e(t)]?.sidebar?"on":""}`)),()=>(e(a),e(t),b(()=>!!e(a)?.[e(t)]?.sidebar)),()=>(e(a),e(t),b(()=>e(a)?.[e(t)]?.sidebar?"On":"Off"))]),$("click",O,()=>_e(e(t))),w(n,C)}),i(r),w(s,r)};ne(Ae,s=>{e(B)||h()||e(N)?s(xe):s(Ee,!1)})}i(re),i(q),D(()=>{H.disabled=e(p)||h(),F.disabled=e(R)||h(),T.disabled=e(p)||h()||!e(v),_(Re,e(p)?"Guardando...":"Guardar cambios"),A.disabled=h()||e(B)}),$("click",H,Ce),$("click",F,Oe),$("click",T,ye),Ke(A,()=>e(l),s=>o(l,s)),$("change",A,ke),w(pe,q),Ge(),ge()}export{As as component};
